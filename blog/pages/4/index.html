<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="preload" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff" as="font" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shuhei Kagawa</title><link rel="icon" sizes="16x16 32x32 48x48" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="Atom feed of Shuhei Kagawa" href="/blog/feed.xml"><style>:root{--bg-color:#f9f9f9;--text-color:#222;--highlight-color:#095ae8;--code-text-color:var(--code-mono-1);--code-bg-color:#fff;--syntax-hue:230;--syntax-saturation:1%;--syntax-brightness:100%;--code-mono-1:hsl(var(--syntax-hue),8%,24%);--code-mono-2:hsl(var(--syntax-hue),6%,44%);--code-mono-3:hsl(var(--syntax-hue),4%,64%);--code-hue-1:#0184bc;--code-hue-2:#1d56d3;--code-hue-3:#a626a4;--code-hue-4:#188816;--code-hue-5:#ce3527;--code-hue-5-2:#ca1243;--code-hue-6:#986801;--code-hue-6-2:#986801;--body-font-family:"Libre Baskerville",serif;--heading-font-family:"Libre Franklin",sans-serif;--code-font-family:"DM Mono",monospace}body{background:#f9f9f9;background:var(--bg-color);color:#222;color:var(--text-color);font-family:Libre Baskerville,serif;font-family:var(--body-font-family);font-size:16px;line-height:1.9;margin:0;padding:0}.container{margin:0 auto;padding:0 20px;width:700px}a{color:#095ae8;color:var(--highlight-color);text-decoration:none;transition:color .5s ease}a:hover{text-decoration:underline}.header{display:flex;padding:1.5em 0 1em}.header__title{flex-grow:1;font-size:1em;font-weight:400;margin:0 10px 0 0}.header__title a{color:#222;color:var(--text-color)}.header__nav{flex-grow:0}.menu{list-style-position:outside;list-style-type:none;margin:0;padding:0;text-align:right}.menu__item{display:inline-block;padding:0 0 0 .7em}.menu__item a{color:#222;color:var(--text-color)}.footer{padding:3em 0 4em;text-align:center}.title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:3em;line-height:1.1;margin:0 0 .2em}.title a{color:#222;color:var(--text-color);text-decoration:none}.post,.post-list{padding:1.7em 0 1.25em}.post:after{content:"* * *";display:block;font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:4.5em;font-weight:700;line-height:1;margin:.9em auto 0;text-align:center}.post .meta{font-size:.75em}.post-list .title{margin-bottom:10px}.post-list-item{display:flex;line-height:1.6em;padding:10px 0}.post-list-item__date{flex-shrink:0;font-size:.8em;width:8em}.post-list-item__title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:1.3em;font-weight:700;margin:0}.post-list-item__title a{color:#222;color:var(--text-color);text-decoration:none}.content h2,.content h3,.content h4,.content h5,.content h6{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);margin:1em 0 0}.content h2{font-size:2.2em;line-height:1.1}.content h3{font-size:1.6em;line-height:1.3}.content h4{font-size:1.2em}.content img{height:auto;max-width:100%}.content p{margin:1.15em 0}.img-wrapper{display:block;text-align:center}.comments{margin-bottom:3em}ol,ul{list-style-position:outside;padding-left:1.4em}.table-wrapper{margin:1.15em 0;overflow-x:auto}.table-wrapper table{border-collapse:collapse;margin:0;width:100%}tr{vertical-align:top}th{font-weight:400;text-align:left}tbody{border-bottom:1px solid #333;border-top:1px solid #333;padding:.5em 0}td,th{padding-right:1em}code{background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);font-family:DM Mono,monospace;font-family:var(--code-font-family);font-size:.9em;padding:0 .3em}.code__filename{background-color:#666;display:inline-block;font-size:.85em;margin-bottom:13px;padding:5px 10px}.hljs{-webkit-overflow-scrolling:touch;background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);display:block;line-height:1.5em;overflow-x:auto;padding:1em 20px}.hljs-comment,.hljs-quote{color:#696c77;color:var(--code-mono-2);font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--code-hue-3)}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ce3527;color:var(--code-hue-5)}.hljs-literal{color:#0184bc;color:var(--code-hue-1)}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#188816;color:var(--code-hue-4)}.hljs-built_in,.hljs-class .hljs-title{color:#986801;color:var(--code-hue-6-2)}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--code-hue-6)}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#1d56d3;color:var(--code-hue-2)}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}blockquote{font-style:italic;margin:1.5em 0;padding:0 0 0 2em}blockquote p:first-child:before{content:open-quote;font-family:serif;font-size:3em;font-weight:700;line-height:.1em;margin-right:.2em;vertical-align:-.4em}blockquote cite{color:#999990}blockquote cite:before{content:"- "}.pagination{display:flex;justify-content:space-between;list-style-position:outside;list-style-type:none;margin-top:20px;padding:0}.pagination__next-page,.pagination__prev-page{width:46%}.pagination__next-page{text-align:right}.footer-nav{text-align:center}@media only screen and (max-width:767px){body{font-size:15px;line-height:1.65}.container{width:auto}.post,.post-list{padding-top:10px}.post-list-item{display:block}.hljs{border-radius:0;margin-left:-20px;margin-right:-20px;padding:1.4em 20px}li .hljs{margin-left:0}.img-wrapper{margin-left:-20px;margin-right:-20px}}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthSQBK6PYK3EXw.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWx8QDO-WyrubOA.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNXaxMaC82U-ro.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkD9DPTedX18mETQw.woff) format("woff");unicode-range:u+0102-0103,u+0110-0111,u+0128-0129,u+0168-0169,u+01a0-01a1,u+01af-01b0,u+1ea0-1ef9,u+20ab}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkDtDPTedX18mETQw.woff) format("woff");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff) format("woff");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}</style><meta name="description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@shuheikagawa"><meta property="og:title" content="Shuhei Kagawa"><meta property="og:site_name" content="Shuhei Kagawa"><meta property="og:description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."></head><body><div class="container"><header class="header"><h1 class="header__title"><a href="/">Shuhei Kagawa</a></h1><nav class="header__nav"><ul class="menu"><li class="menu__item"><a href="/about/">About</a></li><li class="menu__item"><a href="/blog/archives/">All posts</a></li></ul></nav></header><div class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2020/01/26/responsive-images-with-a-static-site-generator/">Responsive images with a static site generator</a></h1><div class="meta"><span class="date">Jan 26, 2020</span> - <a href="/blog/tags/Blog">Blog</a>, <a href="/blog/tags/JavaScript">JavaScript</a></div></div><div class="content"><div><h2>Responsive images</h2><p>An <code>img</code> without <code>width</code>/<code>height</code> attributes causes a page jump when it's loaded. It happens because the browser doesn't know the dimensions of the image until its data is loaded—only the first part that contains dimensions is enough though. It's common to specify <code>width</code> and <code>height</code> of <code>img</code> tag to avoid the jump.</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/foo.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Foo"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span> /&gt;</span>
</code></pre><p>But <code>img</code> tag with <code>width</code> and <code>height</code> doesn't always work well with Responsive Design because the dimensions are fixed. I wanted images to fit the screen width on mobile phones. So I left images without <code>width</code>/<code>height</code> and let them cause page jumps.</p><p>Recently, I came across a similar problem at work and learned a cool technique to create a placeholder of the image's aspect ratio with <code>padding-top</code>. If the image's aspect ratio is <code>height/width = 75/100</code>:</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: relative; padding-top: 75%;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: absolute; top: 0; left: 0; max-width: 100%;"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><p>The <code>div</code> works as a placeholder with the image's aspect ratio that fits the width of its containing element. Because the <code>img</code> tag has <code>position: absolute</code>, it doesn't cause a page jump when it's loaded.</p><p>I decided to implement it on this blog. This blog is made with a custom static site generator. I'm not sure if it's useful for anyone else, but I write how I did it anyway…</p><h2>Limiting overstretch</h2><p>In addition to images that are wide enough to always fill the full width of the content area, I had images that are not wide enough to fill the full width of a laptop, but wide enough to fill the full width of a mobile phone. Not to stretch the image on laptops, I decided to go with another wrapper to limit the maximum width of the image. If the image's width is <code>500px</code>:</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"max-width: 500px;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: relative; padding-top: 75%;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: absolute; top: 0; left: 0; max-width: 100%;"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><h2>Getting image dimensions</h2><p>The placeholder technique requires image dimensions. I used <a href="https://github.com/image-size/image-size">image-size module</a> to get image dimensions.</p><p>The following function gets dimensions of images in a directory and returns them as a <code>Map</code>.</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-attr">promises</span>: fs } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> sizeOf = util.<span class="hljs-title function_">promisify</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">"image-size"</span>).<span class="hljs-property">imageSize</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readImageSizes</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">const</span> files = (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readdir</span>(dir)).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"."</span>));
  <span class="hljs-keyword">const</span> promises = files.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> file =&gt; {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">resolve</span>(dir, file);
    <span class="hljs-keyword">const</span> dimensions = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sizeOf</span>(filePath);
    <span class="hljs-keyword">return</span> [file, dimensions];
  });
  <span class="hljs-keyword">const</span> entries = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(entries);
}
</code></pre><h2>Custom renderer of Marked</h2><p>This blog's posts are written in Markdown, and its static site generator uses <a href="https://github.com/markedjs/marked">marked</a> to convert Markdown into HTML. One of my favorite things about <code>marked</code> is that we can easily customize its behavior with a custom renderer.</p><p>I used <code>span</code> tags to wrap <code>img</code> tag because they are rendered in <code>p</code> tag, which can't contain block tags like <code>div</code>.</p><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRenderer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">marked.Renderer</span> {
  <span class="hljs-title function_">image</span>(<span class="hljs-params">src, title, alt</span>) {
    <span class="hljs-keyword">const</span> dimensions = <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageDimensions</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageDimensions</span>.<span class="hljs-title function_">get</span>(src);
    <span class="hljs-keyword">if</span> (dimensions) {
      <span class="hljs-keyword">const</span> { width, height } = dimensions;
      <span class="hljs-keyword">const</span> aspectRatio = (height / width) * <span class="hljs-number">100</span>;
      <span class="hljs-keyword">return</span> (
        <span class="hljs-string">`&lt;span class="responsive-image-wrapper" style="max-width: <span class="hljs-subst">${width}</span>px;"&gt;`</span> +
        <span class="hljs-string">`&lt;span class="responsive-image-inner" style="padding-top: <span class="hljs-subst">${aspectRatio}</span>%;"&gt;`</span> +
        <span class="hljs-string">`&lt;img class="responsive-image" src="<span class="hljs-subst">${src}</span>" alt="<span class="hljs-subst">${alt}</span>"&gt;`</span> +
        <span class="hljs-string">"&lt;/span&gt;"</span> +
        <span class="hljs-string">"&lt;/span&gt;"</span>
      );
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">image</span>(src, title, alt);
  }

  <span class="hljs-comment">// To set images dimensions when images are changed</span>
  <span class="hljs-title function_">setImageDimensions</span>(<span class="hljs-params">imageDimensions</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageDimensions</span> = imageDimensions;
  }
}
</code></pre><p>And CSS:</p><pre><code class="hljs css"><span class="hljs-selector-class">.responsive-image-wrapper</span> {
  <span class="hljs-attribute">display</span>: block;
}
<span class="hljs-selector-class">.responsive-image-inner</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.responsive-image</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
}
</code></pre><h2>Result</h2><p>Here are a few examples:</p><ul><li><a href="/blog/2019/12/31/2019-in-review/">Full width on laptop and mobile</a></li><li><a href="/blog/2010/07/10/surface/">Full width on mobile but not on laptop</a></li></ul><p>Yay, no more page jump! Well, web fonts still make the page slightly jump, but that's another story...</p><p>I skipped some details that are specific to my website. The full code is <a href="https://github.com/shuhei/shuhei.github.com/pull/45">on GitHub</a>.</p></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2019/12/31/winter-terminal-cleaning/">Winter terminal (mostly Vim) cleaning</a></h1><div class="meta"><span class="date">Dec 31, 2019</span> - <a href="/blog/tags/Vim">Vim</a></div></div><div class="content"><div><p>In December, I spent some time cleaning up my terminal setup. Dust had piled up in a year, and my terminal was getting slower. It was time to dust off.</p><p>Here are highlights of <a href="https://github.com/shuhei/dotfiles/compare/d5fa68a7514b040d0d19466ee85ebfbeb30b1d37...a8344b9d204af70f36ac8505df62425e87c5273d">the changes</a>.</p><h2>Faster text rendering</h2><p>I noticed a non-negligible lag when I was editing JavaScript/TypeScript in Neovim. At first, I thought some Vim plugins caused it. But it was not true. Not only editing was slow, but also scrolling was slow. Text rendering itself was the problem.</p><p>I opened files of different types in Vim's vertical split and <code>less</code> in tmux's vertical split. And I scrolled down and (subjectively) evaluated the smoothness of scrolling.</p><p>It turned out that Vim was not the problem. With vertical splits of tmux, even <code>less</code> command was slow to scroll. Regardless of Vim or tmux, text rendering in vertical splits was slow on iTerm2. In retrospect, it makes sense because iTerm2 doesn't know about vertical split by Vim or tmux and can't limit rendering updates to the changed pane. <a href="https://www.iterm2.com/documentation-tmux-integration.html">iTerm2's tmux integration</a> may have helped, but I didn't try that.</p><p>I tried <a href="https://github.com/jwilm/alacritty">Alacritty</a>, and it was much faster! I had been using Alacritty before but switched back to iTerm2 for font ligatures. Now I didn't care much about font ligatures—ligatures look pretty, but glyphs for <code>!=</code> and <code>!==</code> confused me in JavaScript. So I switched to Alacritty again.</p><p>Also, I stopped using <a href="https://github.com/jordwalke/flatlandia">flatlandia</a> color scheme in Vim, and it improved the rendering speed a bit. I didn't dig into why, though.</p><h2>fzf.vim</h2><p><a href="https://github.com/junegunn/fzf.vim">fzf.vim</a> was a life changer. It provides a blazing fast incremental search for almost anything. I use it for file names (instead of <a href="https://github.com/kien/ctrlp.vim">ctrlp.vim</a>), commit history and grep. Especially, incremental grep with a preview is amazing.</p><h2>More Vim cleaning</h2><ul><li><p>Started using <a href="https://github.com/dense-analysis/ale">ale</a> as a <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a> client. I was using ale for linting and fixing, and <a href="https://github.com/autozimu/LanguageClient-neovim">LanguageClient-neovim</a> for LSP features. LanguageClient-neovim also shows a quickfix window when a file contains syntax errors and was conflicting with ale. I learned that ale supported LSP as well and made it handle LSP too.</p><ul><li><em>Update on Jan 3, 2020:</em> I started using <a href="https://github.com/neoclide/coc.nvim">coc.nvim</a> instead of ale and deoplete.nvim for autocomplete, linting, fixing and LSP features. It makes Vim an IDE. Simply incredible.</li></ul></li><li><p>Configured Vim to open <code>:help</code> in a vertical split. <code>:help</code> is a valuable resource when configuring Vim. The problem for me was that Vim opens help in a horizontal split by default. Opening help in a vertical split makes it much easier to read.</p><pre><code class="hljs vim"><span class="hljs-keyword">autocmd</span> FileType <span class="hljs-keyword">help</span> <span class="hljs-keyword">wincmd</span> H
</code></pre></li><li><p>Sorted out JavaScript/JSX/TypeScript syntax highlighting. Vim sets <code>javascriptreact</code> to <code>.jsx</code> and <code>typescriptreact</code> to <code>.tsx</code> by default. But those file types don't work well with the plugin ecosystem because plugins for <code>javascript</code>/<code>typescript</code> file types don't work with <code>javascriptreact</code>/<code>typescriptreact</code> and popular JSX/TSX plugins use <code>javascript.jsx</code> and <code>typescript.tsx</code>.</p><pre><code class="hljs vim"><span class="hljs-keyword">autocmd</span> BufRead,BufNewFile *.jsx <span class="hljs-keyword">set</span> <span class="hljs-keyword">filetype</span>=javascript.jsx
<span class="hljs-keyword">autocmd</span> BufRead,BufNewFile *.tsx <span class="hljs-keyword">set</span> <span class="hljs-keyword">filetype</span>=typescript.tsx
</code></pre></li><li><p>Stopped unnecessarily lazy-loading Vim plugins with <a href="https://github.com/Shougo/dein.vim">dein.vim</a>. I had configured file-type-specific plugins as lazy plugins of dein.vim without understanding much. The truth was that lazy plugins are meaningful only for plugins with <code>plugin</code> directory. Most of the file-type-specific plugins don't have <code>plugin</code> directory and are lazily loaded by default with <code>ftdetect</code> and <code>ftplugin</code>. <code>:echo dein#check_lazy_plugins()</code> shows those plugins that are ill-configured. I finally learned <a href="https://learnvimscriptthehardway.stevelosh.com/chapters/42.html">what those plugin directories do</a> after using Vim for several years...</p></li><li><p>Reviewed key mappings and removed waiting time by avoiding mappings that prefixed other mappings. For example, I had mappings of <code>,g</code> and <code>,gr</code>. <code>,g</code> was slow because Vim had to wait for a while to determine it was <code>,g</code> or <code>,gr</code>.</p></li><li><p>Tried Vim 8 but switched back to Neovim. Vim 8 worked well, but tiny details looked smoother in Neovim. For example, when syntax highlighting hangs up, Vim 8 hangs up while Neovim disables syntax highlighting and goes on.</p></li><li><p>Started documentation of my setup. I keep forgetting key mappings, useful plugins that I occasionally use, how things are set up, etc.</p></li></ul></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2019/12/31/2019-in-review/">2019 in review</a></h1><div class="meta"><span class="date">Dec 31, 2019</span> - <a href="/blog/tags/Review">Review</a></div></div><div class="content"><div><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/p1VoX43jMh-700.avif 700w, /cached/p1VoX43jMh-900.avif 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/p1VoX43jMh-700.webp 700w, /cached/p1VoX43jMh-900.webp 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/p1VoX43jMh-700.jpeg 700w, /cached/p1VoX43jMh-900.jpeg 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Aegina island in April" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVQImWOozEnt6shNSfayMFT3cTcL8DBzttJyc9Qz1lNgCHXUq80NTEvyMTNUd7HXzU119LbVV5IRcbbUZghxtYz3tIpyN4wOdapva8yL9/az0lGUFrY10WWoiXdO8rayVpMpiA9at35ZUbJXsJWWsbqkh5MpQ29tYWVmrJGSjIWeVldjZXNOXGmIQ1moebizMUNWTIivpb6JuryeulJCRMiiic25AR7BpjpxLoYMBtISSpLCOsqyhjrqKdEhExvLovzc3Qx1Qk3UAV82N0d7bzpIAAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/p1VoX43jMh-700.jpeg" width="900" height="675"></picture></span></p><h2>Travels</h2><p>I visited six new countries and enjoyed each of them.</p><ul><li>January: Japan</li><li>March: Budapest, Hungary</li><li>April: Athens and Aegina, Greece</li><li>April: Wrocław, Poland</li><li>June: Prague, Czech Republic</li><li>August: Brussels and Bruges, Belgium</li><li>September: Munich, Germany</li><li>October: Dubrovnik, Croatia</li><li>November: Japan</li></ul><p>There are many more places to visit in Europe. I'll keep traveling in 2020.</p><h2>Bike</h2><p>I bought an entry-level road bike at Decathlon in June. I used it for commuting and made day trips around Berlin. Berlin is surrounded by amazing fields. Blankenfelde is my favorite so far. I can't wait for the next Spring.</p><h2>Budgeting</h2><p>I started using <a href="https://www.youneedabudget.com/">YNAB</a> at the end of the last year because a few of my friends were using it. I have used it throughout the year, and it's the first budgeting system that worked well for me. It helps us traveling regularly while saving money.</p><h2>Books</h2><p>I bought 55 physical books and 5 ebooks. That's three times more than the last year, probably because of a dedicated budget for buying books.</p><p>I finished reading 14 books and stranded somewhere in the middle of many books. <em>Quiet</em> made me more introverted and now I spend more time at home. <em>Bad Blood</em> and <em>Educated</em> blew my mind.</p><h2>Drink</h2><p>While it's hard to name the best food of the year, the best beer of 2019 was a porter at <a href="https://goo.gl/maps/9X7UMJnqB1MrzqJcA">Kontynuacja</a> in Wrocław, Poland. The city had high-quality craft beers, and everything that I drank was amazing.</p><p>I had a chance to meet one of my most favorite brewers, Fuerst Wiacek, at a tap takeover event at Biererei Bar. I bought a T-shirt.</p><p>The trip to Brussels was epic as well because I visited a traditional lambic brewery where they still brew beer with yeasts in the air of the building! After tasting sour lambic, I bought a T-shirt there too.</p><p>In spite of the encounters with good beers, I don't drink as much as I used to anymore. When I started commuting by bike, I didn't want to get drunk and ride a bike. Even after I stopped commuting with my bike in the winter, the momentum kept going. I drank almost every day in Japan as an exception, but I almost quit drinking again after coming back to Berlin.</p><p>On the other hand, I started drinking bubble tea regularly. There is a <a href="http://www.comebuy2002.de/">Comebuy</a> shop near my office. I tried several bubble tea shops in Tokyo and found that only a few were better than Comebuy—I liked Yi Fang most.</p><h2>Work</h2><p>I am still working on the same team in Zalando. I looked for new opportunities inside and outside the company but decided to stay a bit more.</p><p>My team and I started on-call duties. Before that, another on-call team was taking care of my team's applications, and we tried to make sure that they didn't get called. Our focus on reliability hasn't changed much, but being on-call triggered new learnings. Writing post-mortem documents is my new favorite activity.</p><p>I started interviewing regularly, mostly on coding. I'm still not used to it, and there's more to learn.</p><h2>Side projects</h2><p>In the first half of the year, I wrote <a href="https://github.com/shuhei/rolling-window">a small metrics utility</a> for work and <a href="/blog/2019/10/06/interpreter-and-compiler-in-rust/">a toy interpreter and compiler in Rust</a> for fun. In the last half, I focused more on learning classic algorithms than side projects.</p><h2>Conferences and meetups</h2><p>I attended two conferences, JSConf EU and JSConf JP, and had a chance to <a href="https://speakerdeck.com/shuhei/profiling-node-dot-js-apps-on-production">speak at a meetup</a>.</p><h2>2020</h2><p>Looking back, 2019 was fun. I wish 2020 would be a happy year for all of you!</p></div></div></div><ul class="pagination"><li class="pagination__prev-page"><a href="/blog/pages/3/">Newer posts</a></li><li class="pagination__next-page"><a href="/blog/pages/5/">Older posts</a></li></ul><nav class="footer-nav"><a href="/blog/archives/">All posts</a></nav></div><footer class="footer">© Shuhei Kagawa</footer></div></body></html>