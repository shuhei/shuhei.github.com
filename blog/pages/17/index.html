<!doctype html>
    <html >
      <head>
        <meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1"/>
        <title data-react-helmet="true">Page 17 - Shuhei Kagawa</title>
        <link data-react-helmet="true" rel="icons" sizes="16x16 32x32 48x48" href="/favicon.ico"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="RSS Feed for shuheikagawa.com" href="/blog/feed/rss.xml"/><link data-react-helmet="true" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Asap:4000,700"/><link data-react-helmet="true" rel="stylesheet" href="/css/style.css"/>
      </head>
      <body>
        <div><div data-reactroot="" data-reactid="1" data-react-checksum="1065503573"><!-- react-empty: 2 --><header class="header" data-reactid="3"><h1 class="header__title" data-reactid="4"><a href="/" data-reactid="5">Shuhei Kagawa</a></h1><nav data-reactid="6"><ul class="menu" data-reactid="7"><li class="menu__item" data-reactid="8"><a href="/about" data-reactid="9">About</a></li><li class="menu__item" data-reactid="10"><a href="/works" data-reactid="11">Works</a></li><li class="menu__item" data-reactid="12"><a href="/blog/archives" data-reactid="13">Archives</a></li></ul></nav></header><div class="main" data-reactid="14"><div data-reactid="15"><div class="post" data-reactid="16"><div class="post-header" data-reactid="17"><h1 class="title" data-reactid="18"><a href="/blog/2010/01/16/update-macports" data-reactid="19">MacPorts のアップデート</a></h1><div class="meta" data-reactid="20"><!-- react-text: 21 -->@<!-- /react-text --><span class="date" data-reactid="22">2010-01-16 14:49</span></div></div><div class="content" data-reactid="23"><div data-reactid="24"><p>port search xxx として出てくるものが古いときに。</p>
<p>MacPorts をアップデート。</p>
<pre class="prettyprint">sudo port selfupdate</pre>
<p>パッケージを更新。</p>
<pre class="prettyprint">sudo port sync</pre>
<p>たまにやった方がいいようですね。</p>
<p>via <a href="http://d.hatena.ne.jp/kanonji/20091025/1256495516">MacPortsをちゃんと使うために調べてみた &#8211; kanonjiの日記</a></p></div></div></div><div class="post" data-reactid="25"><div class="post-header" data-reactid="26"><h1 class="title" data-reactid="27"><a href="/blog/2010/01/11/install-passenger" data-reactid="28">Ubuntu Server に Passenger をインストール</a></h1><div class="meta" data-reactid="29"><!-- react-text: 30 -->@<!-- /react-text --><span class="date" data-reactid="31">2010-01-11 23:00</span></div></div><div class="content" data-reactid="32"><div data-reactid="33"><h3>Aptitude ではだめ</h3>
<p>とりあえずは apt-get と思い、下記のようにしたらとしたら libapache2-mod-php5 などが消されて焦りました。</p>
<pre class="prettyprint">sudo apt-get install libapache2-mod-passenger</pre>
<p>Aptitude を使うと、Passenger と <span class="caps">PHP</span> 5 は共存できないようです。<br />
それぞれが依存している apache2-mpm-worker と apache2-mpm-prefork が共存できないのが原因のよう。<br />
via <a href="https://forums.ubuntulinux.jp/viewtopic.php?id=5341">Ubuntu日本語フォーラム / ubuntu 9.04 passenger と　php5は共存できない？</a></p>
<h3>Gem でインストール</h3>
<p>しょうがないので <span class="caps">PHP</span> 5 を入れ直し、Passenger を gem で入れる事にしました。</p>
<pre class="prettyprint">sudo gem install passenger
sudo /var/lib/gems/1.8/bin/passenger-install-apache2-module</pre>
<p>足りないパッケージさあれば教えてくれるので、インストールしてから再度実行。</p>
<pre class="prettyprint">sudo /var/lib/gems/1.8/bin/passenger-install-apache2-module</pre>
<h3>設定ファイルの記述</h3>
<p>httpd.conf には直接書かず、専用のファイルを作ります。Ubuntu の流儀？</p>
<p>/etc/apache2/mods-available/passenger.load</p>
<pre class="prettyprint">LoadModule passenger_module /var/lib/gems/1.8/gems/passenger-2.2.9/ext/apache2/mod_passenger.so</pre>
<p>/etc/apache2/mods-available/passenger.conf</p>
<pre class="prettyprint">&lt;ifModule mod_passenger.c&gt;
  PassengerRoot /var/lib/gems/1.8/gems/passenger-2.2.9
  PassengerRuby /usr/bin/ruby1.8
&lt;/ifModule&gt;</pre>
<p>モジュールを有効に。<br />
mods-enabled から mods-available にシンボリックリンクを張って有効にするんですね。知りませんでした。</p>
<pre class="prettyprint">sudo ln -s /etc/apache2/mods-available/passenger.load /etc/apache2/mods-enabled/passenger.load
sudo ln -s /etc/apache2/mods-available/passenger.conf /etc/apache2/mods-enabled/passenger.conf</pre>
<h3>サブディレクトリで公開</h3>
<p>ルート以外で公開したい場合、まずは公開ディレクトリにシンボリックリンクを作成します。</p>
<pre class="prettyprint">sudo ln -s /path/to/app-name/public /path/to/www/app-name</pre>
<p>そして、Apache の設定ファイルに少し付け足します。</p>
<p>/etc/apache2/mods-available/passenger.conf</p>
<pre class="prettyprint">&lt;ifModule mod_passenger.c&gt;
  PassengerRoot /var/lib/gems/1.8/gems/passenger-2.2.9
  PassengerRuby /usr/bin/ruby1.8
  RailsBaseURI /app-name
&lt;/ifModule&gt;</pre>
<p>via <a href="http://blog.suz-lab.com/2009/05/passengerredmine.html">suz-lab &#8211; blog: PassengerでRedmineをサブディレクトリに公開</a></p></div></div></div><div class="post" data-reactid="34"><div class="post-header" data-reactid="35"><h1 class="title" data-reactid="36"><a href="/blog/2010/01/04/build-biffpop-for-mydnsjp" data-reactid="37">MyDNS.jp 用に biffpop をビルド</a></h1><div class="meta" data-reactid="38"><!-- react-text: 39 -->@<!-- /react-text --><span class="date" data-reactid="40">2010-01-04 02:17</span></div></div><div class="content" data-reactid="41"><div data-reactid="42"><p>無料ダイナミック <span class="caps">DNS</span> サービスの MyDNS.jp では、IP アドレスの通知にメールサーバへのアクセスという方法を採用しています。<br />
<span class="caps">POP</span> のクライアントソフトとして説明ページでおすすめされていた <a href="http://www.nakata-jp.org/computer/freesoft/biffpop.html">biffpop</a> をビルドする際につまずいたのでメモ。<br />
環境は Ubuntu Server 9.10 64 bit。</p>
<p>ソースをダウンロードして make すると、下記のようなエラー。</p>
<blockquote>
<p>cc -O3 -DIPv6 -<span class="caps">DKILLLIST</span> -DUSE_<span class="caps">SSL</span>  -c -Wall biffpop.c -o biffpop.o<br />
biffpop.c:24:25: error: openssl/ssl.h: No such file or directory<br />
biffpop.c:25:25: error: openssl/err.h: No such file or directory<br />
biffpop.c:47: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘*’ token<br />
biffpop.c: In function ‘main’:<br />
biffpop.c:124: error: ‘_RE_SYNTAX_POSIX_<span class="caps">COMMON</span>’ undeclared (first use in this function)<br />
biffpop.c:124: error: (Each undeclared identifier is reported only once<br />
biffpop.c:124: error: for each function it appears in.)<br />
biffpop.c:127: warning: implicit declaration of function ‘SSL_load_error_strings’<br />
biffpop.c:128: warning: implicit declaration of function ‘SSL_library_init’<br />
biffpop.c:129: error: ‘ctx’ undeclared (first use in this function)<br />
biffpop.c:129: warning: implicit declaration of function ‘SSL_CTX_new’<br />
biffpop.c:129: warning: implicit declaration of function ‘SSLv23_client_method’<br />
biffpop.c:130: warning: implicit declaration of function ‘ERR_print_errors_fp’<br />
biffpop.c:138: warning: implicit declaration of function ‘SSL_CTX_free’<br />
biffpop.c:139: warning: implicit declaration of function ‘ERR_free_strings’<br />
biffpop.c: In function ‘readConfigFileSub’:<br />
biffpop.c:439: warning: implicit declaration of function ‘re_compile_pattern’<br />
biffpop.c:440: warning: assignment makes pointer from integer without a cast<br />
make: *** [biffpop.o] Error 1</p>
</blockquote>
<p>OpenSSL は入っているのにおかしいな、と思ったのですが、libssl-dev がいるっぽいです。<br />
<a href="http://forum.qmailrocks.org/archive/index.php/t-963.html">openssl/ssl.h: No such file or directory [Archive] &#8211; Qmailrocks.org Forum</a></p>
<pre class="prettyprint">sudo apt-get install libssl-dev
make</pre>
<p>まだ少しエラー。</p>
<blockquote>
<p>cc -O3 -DIPv6 -<span class="caps">DKILLLIST</span> -DUSE_<span class="caps">SSL</span>  -c -Wall biffpop.c -o biffpop.o<br />
biffpop.c: In function ‘main’:<br />
biffpop.c:124: error: ‘_RE_SYNTAX_POSIX_<span class="caps">COMMON</span>’ undeclared (first use in this function)<br />
biffpop.c:124: error: (Each undeclared identifier is reported only once<br />
biffpop.c:124: error: for each function it appears in.)<br />
biffpop.c: In function ‘readConfigFileSub’:<br />
biffpop.c:439: warning: implicit declaration of function ‘re_compile_pattern’<br />
biffpop.c:440: warning: assignment makes pointer from integer without a cast<br />
make: *** [biffpop.o] Error 1</p>
</blockquote>
<p>今度は regex.h のエラー。ソースを見てみると <code>_RE_SYNTAX_POSIX_COMMON</code> は <code>#ifdef __USE_GNU</code> で囲まれています。<br />
<code>__USE_GNU</code> をオンにするには <code>#define _GNU_SOURCE</code> するか <code>cc -D _GNU_SOURCE</code> すれば良いらしい。</p>
<p>・・・ということまではわかりましたが、よく考えると上記二つは <code>-DKILLLIST</code> と <code>-DUSE_SSL</code> をつけなければ起きないエラーです。<span class="caps">SSL</span>も正規表現によるメールの削除も、今回の用途には必要ありません。</p>
<p>Makefile を よく読むと <code>#FLAGS  = -O3      # for mydns.jp system simple function</code> と書いてありました。<br />
親切にも MyDNS ユーザ用のオプションが用意されていた訳です。<br />
この行のコメントを外し、フルオプションの方（ <code>FLAGS  = -O3 -DIPv6 -DKILLLIST -DUSE_SSL # full option IPv6, Kill List &amp; SSL</code> ）をコメントアウトすると、ビルドできました。<br />
めでたしめでたし。</p></div></div></div><ul class="pagination" data-reactid="43"><li class="pagination__prev-page" data-reactid="44"><a href="/blog/pages/16" data-reactid="45">Newer Posts</a></li><li class="pagination__archives" data-reactid="46"><a href="/blog/archives" data-reactid="47">Archives</a></li><li class="pagination__next-page" data-reactid="48"><a href="/blog/pages/18" data-reactid="49">Older Posts</a></li></ul></div></div><footer class="footer" data-reactid="50"><!-- react-text: 51 -->© <!-- /react-text --><!-- react-text: 52 -->Shuhei Kagawa<!-- /react-text --><script data-reactid="53">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-309586-8', 'shuheikagawa.com');
    ga('send', 'pageview');
  </script></footer></div></div>
      </body>
    </html>