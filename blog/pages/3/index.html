<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="preload" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff" as="font" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shuhei Kagawa</title><link rel="icon" sizes="16x16 32x32 48x48" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="Atom feed of Shuhei Kagawa" href="/blog/feed.xml"><style>:root{--bg-color:#f9f9f9;--text-color:#222;--highlight-color:#095ae8;--code-text-color:var(--code-mono-1);--code-bg-color:#fff;--syntax-hue:230;--syntax-saturation:1%;--syntax-brightness:100%;--code-mono-1:hsl(var(--syntax-hue),8%,24%);--code-mono-2:hsl(var(--syntax-hue),6%,44%);--code-mono-3:hsl(var(--syntax-hue),4%,64%);--code-hue-1:#0184bc;--code-hue-2:#1d56d3;--code-hue-3:#a626a4;--code-hue-4:#188816;--code-hue-5:#ce3527;--code-hue-5-2:#ca1243;--code-hue-6:#986801;--code-hue-6-2:#986801;--body-font-family:"Libre Baskerville",serif;--heading-font-family:"Libre Franklin",sans-serif;--code-font-family:"DM Mono",monospace}body{background:#f9f9f9;background:var(--bg-color);color:#222;color:var(--text-color);font-family:Libre Baskerville,serif;font-family:var(--body-font-family);font-size:16px;line-height:1.9;margin:0;padding:0}.container{margin:0 auto;padding:0 20px;width:700px}a{color:#095ae8;color:var(--highlight-color);text-decoration:none;transition:color .5s ease}a:hover{text-decoration:underline}.header{display:flex;padding:1.5em 0 1em}.header__title{flex-grow:1;font-size:1em;font-weight:400;margin:0 10px 0 0}.header__title a{color:#222;color:var(--text-color)}.header__nav{flex-grow:0}.menu{list-style-position:outside;list-style-type:none;margin:0;padding:0;text-align:right}.menu__item{display:inline-block;padding:0 0 0 .7em}.menu__item a{color:#222;color:var(--text-color)}.footer{padding:3em 0 4em;text-align:center}.title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:3em;line-height:1.1;margin:0 0 .2em}.title a{color:#222;color:var(--text-color);text-decoration:none}.post,.post-list{padding:1.7em 0 1.25em}.post:after{content:"* * *";display:block;font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:4.5em;font-weight:700;line-height:1;margin:.9em auto 0;text-align:center}.post .meta{font-size:.75em}.post-list .title{margin-bottom:10px}.post-list-item{display:flex;line-height:1.6em;padding:10px 0}.post-list-item__date{flex-shrink:0;font-size:.8em;width:8em}.post-list-item__title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:1.3em;font-weight:700;margin:0}.post-list-item__title a{color:#222;color:var(--text-color);text-decoration:none}.content h2,.content h3,.content h4,.content h5,.content h6{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);margin:1em 0 0}.content h2{font-size:2.2em;line-height:1.1}.content h3{font-size:1.6em;line-height:1.3}.content h4{font-size:1.2em}.content img{height:auto;max-width:100%}.content p{margin:1.15em 0}.img-wrapper{display:block;text-align:center}.comments{margin-bottom:3em}ol,ul{list-style-position:outside;padding-left:1.4em}.table-wrapper{margin:1.15em 0;overflow-x:auto}.table-wrapper table{border-collapse:collapse;margin:0;width:100%}tr{vertical-align:top}th{font-weight:400;text-align:left}tbody{border-bottom:1px solid #333;border-top:1px solid #333;padding:.5em 0}td,th{padding-right:1em}code{background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);font-family:DM Mono,monospace;font-family:var(--code-font-family);font-size:.9em;padding:0 .3em}.code__filename{background-color:#666;display:inline-block;font-size:.85em;margin-bottom:13px;padding:5px 10px}.hljs{-webkit-overflow-scrolling:touch;background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);display:block;line-height:1.5em;overflow-x:auto;padding:1em 20px}.hljs-comment,.hljs-quote{color:#696c77;color:var(--code-mono-2);font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--code-hue-3)}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ce3527;color:var(--code-hue-5)}.hljs-literal{color:#0184bc;color:var(--code-hue-1)}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#188816;color:var(--code-hue-4)}.hljs-built_in,.hljs-class .hljs-title{color:#986801;color:var(--code-hue-6-2)}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--code-hue-6)}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#1d56d3;color:var(--code-hue-2)}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}blockquote{font-style:italic;margin:1.5em 0;padding:0 0 0 2em}blockquote p:first-child:before{content:open-quote;font-family:serif;font-size:3em;font-weight:700;line-height:.1em;margin-right:.2em;vertical-align:-.4em}blockquote cite{color:#999990}blockquote cite:before{content:"- "}.pagination{display:flex;justify-content:space-between;list-style-position:outside;list-style-type:none;margin-top:20px;padding:0}.pagination__next-page,.pagination__prev-page{width:46%}.pagination__next-page{text-align:right}.footer-nav{text-align:center}@media only screen and (max-width:767px){body{font-size:15px;line-height:1.65}.container{width:auto}.post,.post-list{padding-top:10px}.post-list-item{display:block}.hljs{border-radius:0;margin-left:-20px;margin-right:-20px;padding:1.4em 20px}li .hljs{margin-left:0}.img-wrapper{margin-left:-20px;margin-right:-20px}}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthSQBK6PYK3EXw.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWx8QDO-WyrubOA.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNXaxMaC82U-ro.woff2) format("woff2");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkD9DPTedX18mETQw.woff) format("woff");unicode-range:u+0102-0103,u+0110-0111,u+0128-0129,u+0168-0169,u+01a0-01a1,u+01af-01b0,u+1ea0-1ef9,u+20ab}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkDtDPTedX18mETQw.woff) format("woff");unicode-range:u+0100-024f,u+0259,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff) format("woff");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}</style><meta name="description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@shuheikagawa"><meta property="og:title" content="Shuhei Kagawa"><meta property="og:site_name" content="Shuhei Kagawa"><meta property="og:description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."></head><body><div class="container"><header class="header"><h1 class="header__title"><a href="/">Shuhei Kagawa</a></h1><nav class="header__nav"><ul class="menu"><li class="menu__item"><a href="/about/">About</a></li><li class="menu__item"><a href="/blog/archives/">All posts</a></li></ul></nav></header><div class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2020/11/30/4-years-at-zalando/">4 years at Zalando</a></h1><div class="meta"><span class="date">Nov 30, 2020</span></div></div><div class="content"><div><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/s1NJiiRumD-700.avif 700w, /cached/s1NJiiRumD-900.avif 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/s1NJiiRumD-700.webp 700w, /cached/s1NJiiRumD-900.webp 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/s1NJiiRumD-700.jpeg 700w, /cached/s1NJiiRumD-900.jpeg 900w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Spree in November, 2020" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQImQHEADv/AJSXmpSYmpWXm5aXmpaXm5eYm5qanp2foaOmqACjp6qkqKumqKynqKynqKypqq6srbKvsbW0t7wAt7q7trq8t7q9uru+vb7BxMTHycnL0NHR2dvbALKto6OdmKaelqmgmL6zpsq9rb2xoa6mmq2lmgBUTkllXVdmXVdcVFBsZF5kW1JRSUJJQkFDPTwAUU5PXVxebGtrb25thYKAlpOQmZaTmpWSpqGeAEpEQk1LTUpISEtKSlhVVGNhYG5raXhzcYiCgGBFaI9Wj0VNAAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/s1NJiiRumD-700.jpeg" width="900" height="675"></picture></span></p><p>I’m leaving Zalando with fond memories after 4 years. Here I’m writing down my experience. It’s never comprehensive, but I hope some people find it interesting!</p><h2>Beginning</h2><p>I had lived mostly in Japan for 34 years until 2016. I wanted to travel more, but I was lazy. I decided to work abroad so that I could travel while earning money.</p><p>A job-matching website called <a href="https://www.honeypot.io/">Honeypot</a> introduced me to Zalando. I had 5 interviews and got an offer for Senior Software Engineer (Frontend). I accepted the offer without looking into any other companies because I liked the interviewers and the company’s OSS projects looked interesting. (Honeypot was very happy about it. They put me on their top page and <a href="https://blog.honeypot.io/japanese-developer-in-berlin/">an interview blog post</a>.)</p><p>I moved from Tokyo to Berlin and joined Zalando in October 2016. With 200 other newbies in a month! Zalando is a fashion e-commerce company that sells shoes, clothes, etc. on its website. I had no clue why they needed so many people at the beginning. Isn’t it a website in the end? I later learned that the visible part of the website was the tip of the iceberg. There were many more areas like wholesale, brand relationship, pricing, warehouse management, shipping, payment, and so on.</p><h2>Team(s)</h2><p>In 2016, Zalando was hiring software engineers with <em>pool hiring</em>. We were hired without specific teams to join. After a month of onboarding, each newbie was offered two departments to choose from. I chose the Catalog and Navigation team in the Fashion Store, the e-commerce website of Zalando.</p><p>For the first few months, I thought that the company was providing free beer to employees because fridges were always full of beer bottles even if we drank them a couple of times a week. I later learned that the beer was provided by the delivery lead and the product owner of the team. I joined the right team.</p><p>Aside from the beer, I liked the team. We worked together and played together. It was multi-cultural and magically bonded. It was an old team, but several members including me joined the team in late 2016. We learned the German language and explored the city of Berlin. We had BBQs in a park and drank vodka playing games in the office. It felt like a youth again. Some of the teammates were actually young. After two years or so, we stopped drinking as much as we did. We all became grown-ups...? Maybe.</p><p>Through re-organizations, the shape of the team has changed. It was split into multiple teams. Some people left and new people joined. But I stayed in the same area more or less.</p><h2>Frontend engineer...?</h2><p>At Zalando, frontend engineers were more like JavaScript fullstack engineers.</p><p>In 2016, Zalando had a slogan, <em>Radical Agility</em>. It promoted team autonomy and Microservices to support it. Each engineering team was supposed to operate what they built on top of the <a href="https://stups.io/">STUPS</a> infrastructure. Frontend was not an exception. <a href="https://www.mosaic9.org/">Mosaic</a> (frontend-microservices architecture) allowed each product team to own their Node.js servers for data aggregation and React server-side rendering in addition to frontend components.</p><p>The team’s responsibilities were broad. Building new features and UI improvements with A/B testing, contributing to shared UI components, web performance optimization, Node.js server operations, 24x7 on-call, writing post mortems, and so on.</p><p>In <a href="https://engineering.zalando.com/posts/2018/12/front-end-micro-services.html">the new architecture that the Fashion Store is moving to</a>, product teams don’t need to maintain Node.js servers. I would miss the burden, but I think it’s a good thing.</p><h2>Operation and reliability</h2><p>I had a good opportunity to work on Node.js servers with serious traffic and business impact. Before joining Zalando, I had worked only on products that didn’t take off or were just taking off. I didn’t have much experience in scaling, monitoring, etc. But writing post mortems became one of my favorite activities after 4 years.</p><p>When my team migrated one of Zalando’s most frequently visited pages to the microservice architecture, our journey in this area started. Even among frontend engineers in the team, some of them were frontendy—good at UI—and some of them were backendy. I was a backendy one and started looking into the topic. I found it interesting. It was a nice way to contribute to the team and the business.</p><p>I glimpsed SRE initiatives and Cyber Week preparation being set up and evolving. <a href="https://engineering.zalando.com/posts/2020/10/how-zalando-prepares-for-cyber-week.html">How Zalando prepares for Cyber Week</a> is a great overview of the evolution. I had a good chance to take part in it as a member of a product team. The people who formed the SRE team taught us monitoring, alerting, and reliability patterns (retry, circuit breaker, fallback, etc.). Incident response and post mortems were standardized. Then distributed tracing and <a href="https://www.usenix.org/conference/srecon19emea/presentation/mineiro">adaptive paging</a> were introduced.</p><p>Some of my contributions were reliability improvements of Node.js services. I researched <a href="(/blog/2017/05/13/http-request-timeouts-in-javascript/)">timeout mechanisms of Node.js HTTP client</a> and added a timeout feature to <a href="https://github.com/zalando-incubator/perron">an HTTP client library</a>. <a href="/blog/2019/04/30/dns-polling/">Built a mitigation strategy for DNS timeouts</a>, <a href="/blog/2018/12/29/histogram-for-time-series-metrics-on-node-js/">improved histogram metrics aggregation</a>, <a href="/blog/2018/09/16/node-js-under-a-microscope/">performed profiling and found interesting findings</a>—I had a chance to talk about it in front of a big audience including TC39 folks... I was nervous!</p><p>I was late to the Kubernetes train. The migration from STUPS to Kubernetes didn’t get enough priority in my team. On the other hand, Zalando was an early adapter of Kubernetes and has been <a href="https://www.cncf.io/announcements/2020/08/20/cloud-native-computing-foundation-grants-zalando-the-top-end-user-award/">a strong contributor to the ecosystem</a>. I missed a good learning opportunity to dive into it and learn from the in-house experts.</p><h2>Web performance</h2><p>Another topic that I enjoyed was web performance optimization. It was especially rewarding because it directly contributes to customer experience and the e-commerce business. After my team worked on it, I had an opportunity to write a part of <a href="https://engineering.zalando.com/posts/2018/06/loading-time-matters.html">a blog post about the improvements</a>.</p><p>This topic keeps evolving. New metrics like <a href="https://web.dev/vitals/">Web Vitals</a> and more measurement/optimization techniques came out. It is one of the topics that I would want to pursue if I remained at Zalando.</p><h2>Cross-team collaboration</h2><p>I had a chance to work with many other teams in the Fashion Store and other departments. I met and worked with literally hundreds of colleagues. I had never worked with so many people before joining Zalando.</p><p>That meant more meetings and alignments. I learned decision making with writing. I still don’t say that I’m good at it, but Google Docs became my favorite editor next to Vim.</p><p>I learned that it can be fun to work with many teams. Sometimes it was frustrating because of the time consumed. But it was rewarding to meet with many colleagues and work together.</p><h2>Career</h2><p>I saw good examples of career paths. Before joining Zalando, I imagined only two paths for software engineers. Staying as a senior engineer (or a lead engineer) or becoming a manager. It was great to see another path, being a senior individual contributor who takes technical leadership. At Zalando, it’s called Principal Engineer. In addition to technically leading projects, they shape the tech landscape of the company beyond the scope of a team.</p><p>I was fortunate enough to be promoted to a principal engineer this year. A new role gave me new tasks and a new point of view. It’s one of my regrets to leave this role prematurely.</p><h2>Fun</h2><p>I had a lot of fun.</p><p>Lunch tours to Schlesisches Tor. Countless drinks at the office. After-drink burgers at Burgermeister. A team event on canoes. Summer BBQs in a park. Company parties with thousands of people and getting lost. <em>Mett</em> —German traditional breakfast of minced raw pork—with some beer in the office at 11 am. Ordering <em>Maß</em> at lunch and learning what it meant when 1L of beer arrived...</p><h2>Next</h2><p>It’s been a fun journey. I’m grateful for all the opportunities and learnings. If I went back to 2016, I would do it again.</p><p>I’m going to start a new job tomorrow. I hope it will be fun as well!</p></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2020/02/14/switching-colorschemes-of-vim-and-alacritty/">Switching color schemes of Vim and Alacritty</a></h1><div class="meta"><span class="date">Feb 14, 2020</span> - <a href="/blog/tags/Vim">Vim</a></div></div><div class="content"><div><p>I like fountain pens and good notebooks. They spark joy when I write on paper. Computer terminals are like stationery. A good terminal setup makes it fun to work with computers. Here is how I improved colors on my terminal and made it easy to switch them depending on the time and the mood.</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/Ao3PdLKe5l-700.avif 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/Ao3PdLKe5l-700.webp 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Ayu Light for Vim and Alacritty" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 10 6'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQImRXFTW6CQBgGYE7kLWThbVzIvqsmtIlNDe0hJDFepenGlaTRERiY4W8cvg9m3obFkyco88fZmgGjtWAijOMIkedohg4zMbz30Fqfg4cQx0ZrNEpx23au63pXlKVTbeOstcwTQ0p5DIq8SPuuh+nNZAbr7UiemDwzeyKamBlVJdOgkip9GoIZmJ+GHNPspsm5efYL9h7QukmDn8vvKRN/kPKG5es9g6xvqJVApe6otcA1u5yCl3i7ejtEm8/vaB0nURgfduE+2YUfX9FivU+izev7dvUPCW7N65k19rsAAAAASUVORK5CYII='%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/Ao3PdLKe5l-700.png" width="700" height="446"></picture></span></p><h2>Using official color schemes</h2><p>I have been using Dracula color scheme on Vim and Alacritty for a while. I liked the colors, but I had a small problem with it on Vim. The pop-up of <code>coc.nvim</code> had the same color as the background color, and it was hard to distinguish a pop-up and the background.</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/wjilmgDwGU-700.avif 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/wjilmgDwGU-700.webp 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="dracula from flazz/vim-colorschemes" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 15 4'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQImXXLSw6CMABF0a5GhVKg9AMtULGCCftf0DUBB04YnNy8wRO2jQzLwryupLQzhDcuZDo3oWpLIfWpPFv+baHaifTaCfN2HMfpg/FPtJnR9knnTq1JR41ffntGVHXEdAnvMy5mbMyUKiB14F46boW9JJpmIo4bfVyx/YKPGaVHZBMoqp6H9Je+DkNgPOA40DYAAAAASUVORK5CYII='%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/wjilmgDwGU-700.png" width="700" height="167"></picture></span></p><p>I was using Dracula from <a href="https://github.com/flazz/vim-colorschemes">vim-colorschemes</a>, which hadn’t been updated for three years. I tried <a href="https://github.com/dracula/vim">the official Dracula color scheme for Vim</a>. It had a different background color for pop-ups! Yes, it’s subtle, but now I can distinguish pop-ups from the background.</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/v4MZP4zbLr-700.avif 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/v4MZP4zbLr-700.webp 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="dracula from dracula/vim" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 15 4'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQImXWLPQ+CMABE+TEUKbTIV1tFK2KMIWocHIw6uLn7/5dnJMrm8HLvLrlg227oDzv2pz2354vj+c7x8qA/X3HG4JwbsM6OPnRrCerK0HVrfOuZphmFLtGJJIknKK1RSpHqFKnk4Pq7xXFMUFU1C9ewmC2xZo4xM8q5R5c5QghCIYb8EYbh6IGtHSvvaZqGosop6hylM2QiiaLoL5/zG/sjX1z0D8L+AAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/v4MZP4zbLr-700.png" width="700" height="167"></picture></span></p><p><a href="https://github.com/flazz/vim-colorschemes">vim-colorschemes</a> is a great way to try out different color schemes. You can get a random color scheme by <code>:colorscheme random</code>. But once you pick a few favorite ones, it’s worth checking if they have official color schemes that are likely to be more maintained.</p><p>The same goes for Alacritty. I was using the Dracula color scheme that I converted with <a href="https://github.com/shuhei/colortty">my tool</a> from <a href="https://github.com/mbadolato/iTerm2-Color-Schemes">iTerm2-Color-Schemes</a> for Alacritty. Dracula has <a href="https://github.com/dracula/alacritty">its official Alacritty theme</a>, and it looks better!</p><h2>termguicolors</h2><p>I started trying other color schemes and found Vim’s <code>termguicolors</code> option in <a href="https://github.com/ayu-theme/ayu-vim">ayu-vim</a>’s README. It enables true colors (24-bit colors) instead of 256 colors (8-bit).</p><pre><code class="hljs vim"><span class="hljs-keyword">if</span> <span class="hljs-built_in">has</span>(<span class="hljs-string">'termguicolors'</span>)
  <span class="hljs-keyword">set</span> termguicolors
<span class="hljs-keyword">endif</span>
</code></pre><p>I turned it on, and the colors looked gorgeous! Before learning about <code>termguicolors</code>, I had tried light color schemes like Ayu Light and given up because of too low contrast (left in the following image). With <code>termguicolors</code>, light color schemes became finally usable!</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/SJefG2Skwu-700.avif 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/SJefG2Skwu-700.webp 700w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="ayu light in 256 colors and true colors" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 10 6'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVQImTXMT0rDUBCA8Xei3qJZ9CguXFSDuBIEbRHBGgTxDA2UXqG4cFEMQUs2akMlxEWCwbw37884M6Lgt/qtPlVsnpfMLIjfQkTCLEKIf/5Pa71UefY4twCijQkAQNZaMn1PFoC89wERpW2bucqydQoA4p1D7xx779gYzd57ZmL8PXZdl6pNnqfWWOm1CxY8oQsUXCDoLVnAgCjSfX6lavVwvyjrN9nunuS1KmVb7+S9LqVpK2m7D6maWoqXYqFOL+PBNDkYTa72hmezcXR+fRhd3MRRcncczW6PhpMkHp1M9wc/MPTNTLliR+EAAAAASUVORK5CYII='%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/SJefG2Skwu-700.png" width="700" height="446"></picture></span></p><h2>Switching color schemes</h2><p>After trying dozens of color schemes, I picked the following:</p><ul><li><a href="https://github.com/ayu-theme/ayu-vim">Ayu</a> Light: Good in the morning or at a place with natural light.</li><li><a href="https://github.com/sts10/vim-pink-moon">Pink Moon</a></li><li><a href="https://github.com/arcticicestudio/nord-vim">Nord</a>: Low-contrast theme. Good in the night.</li></ul><p>I started switching color schemes depending on the time and the mood and bumped into a couple of issues. It was tedious to update the color schemes of Vim and Alacritty together. Also, I manage my <code>.alacritty.yml</code> and <code>.vimrc</code> in a git repository. It was annoying that the repository had unstaged changes every time I switched color schemes.</p><h2>Solution</h2><h3>Alacritty</h3><p>I decided to remove <code>.alacritty.yml</code> from the git repository and generate it out of a base template and color scheme files. Once I prepared a YAML file for each color scheme, it was quite easy with a one-liner.</p><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> alacritty/base.yml alacritty/<span class="hljs-variable">${color}</span>.yml &gt; .alacritty.yml
</code></pre><h3>Vim</h3><p>I could have generated <code>.vimrc</code>, but it felt weird because VimScript is a programming language. Instead of generating the whole <code>.vimrc</code>, I decided to generate a color scheme file <code>.vim/color.vim</code>, which is in <code>.gitignore</code></p><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">'let ayucolor="light"\ncolorscheme ayu'</span> &gt; ~/.vim/color.vim
</code></pre><p>and load it from <code>.vimrc</code>.</p><pre><code class="hljs vim"><span class="hljs-keyword">let</span> color_path = <span class="hljs-built_in">expand</span>(<span class="hljs-string">'~/.vim/color.vim'</span>)
<span class="hljs-keyword">if</span> <span class="hljs-built_in">filereadable</span>(color_path)
  exec <span class="hljs-string">'source'</span> color_path
<span class="hljs-keyword">else</span>
  <span class="hljs-comment">" Default color scheme</span>
  <span class="hljs-keyword">colorscheme</span> pink-moon
<span class="hljs-keyword">endif</span>
</code></pre><h3>Putting them together</h3><p>Then, I created a shell script named <code>colorscheme</code> to switch color schemes of Vim and Alacritty together.</p><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span>

color=<span class="hljs-variable">$1</span>
dotfiles=~/dotfiles
alacritty=<span class="hljs-variable">${dotfiles}</span>/alacritty

<span class="hljs-function"><span class="hljs-title">configure_alacritty</span></span>() {
  <span class="hljs-built_in">cat</span> <span class="hljs-variable">${alacritty}</span>/base.yml <span class="hljs-variable">${alacritty}</span>/<span class="hljs-variable">${color}</span>.yml &gt; <span class="hljs-variable">${dotfiles}</span>/.alacritty.yml
}

<span class="hljs-function"><span class="hljs-title">configure_vim</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$1</span> &gt; <span class="hljs-variable">${dotfiles}</span>/.vim/color.vim
}

<span class="hljs-keyword">case</span> <span class="hljs-variable">$color</span> <span class="hljs-keyword">in</span>
  dracula)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme dracula'</span>
    ;;
  nord)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme nord'</span>
    ;;
  pink-moon)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme pink-moon'</span>
    ;;
  ayu-light)
    configure_alacritty
    configure_vim <span class="hljs-string">'let ayucolor="light"\ncolorscheme ayu'</span>
    ;;
  *)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Supported colorschemes: dracula, nord, pink-moon, ayu-light"</span>
    <span class="hljs-built_in">exit</span> 1
    ;;
<span class="hljs-keyword">esac</span>
</code></pre><p>Now I can switch color schemes with only one command! (I still need to restart/reload open Vim sessions, but I can live with it.)</p><pre><code class="hljs sh">colorscheme ayu-light
colorscheme nord
</code></pre><p>If you are curious about the full setup, check out <a href="https://github.com/shuhei/dotfiles">my dotfiles repo</a>.</p><h2>Summary</h2><ul><li>Official color schemes may have more features than color scheme bundles</li><li>Enable <code>termguicolors</code> on Vim</li><li>Switch color schemes with a command!</li></ul></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2020/01/27/goodbye-textile/">Goodbye, Textile</a></h1><div class="meta"><span class="date">Jan 27, 2020</span> - <a href="/blog/tags/Blog">Blog</a>, <a href="/blog/tags/JavaScript">JavaScript</a></div></div><div class="content"><div><p><a href="https://en.wikipedia.org/wiki/Textile_(markup_language)">Textile</a> is a markup language that is similar to Markdown. This blog had had posts written in Textile for more than a decade—I feel old now! I removed the Textile files last weekend. This post is a memoir on the markup language.</p><p>I started using Textile on a blog engine called <a href="https://en.wikipedia.org/wiki/Textpattern">Textpattern</a>. I don’t remember exactly when, but probably around 2004 or 2005. I was a university student. Movable Type was the most popular blog engine at the time, but it changed its license towards a more commercial one. Textpattern was a new open-source software. I fell in love with its minimalism. There were not many Textpattern users in Japan. Information in Japanese was very little if not none. I read documentation and forums in English and translated some into Japanese with a few fellows whom I had never met in person.</p><p>After a few years, Wordpress became a thing, or I realized it did. Even after I moved to Wordpress, I kept writing in Textile. I liked editing Textile more than editing rich text on WYSIWYG editor. I am not sure whether I had heard of Markdown at the time. But it was not as popular or dominant as it is now.</p><p>I started this blog with Textile on Wordpress in 2008 when I started my first job. And I migrated it to Octopress in 2012. I started writing in Markdown with Octopress because it was the lingua franca of GitHub where all the cool things were happening. I had a bit more than a hundred posts in Textile. I kept them in Textile because Octopress supported Textile as well. In 2014, I rebuilt this blog with a handmade static site generator using Gulp. I carried the old Textile files over. I even wrote <a href="https://github.com/shuhei/gulp-textile">gulp-textile</a> plugin, which was just a thin wrapper of <a href="https://github.com/borgar/textile-js">textile-js</a>. It was my first npm package.</p><p>Since then, I implemented a few Markdown-only features like syntax highlighting and responsive table in this blog. The outputs of Markdown and Textile diverged. Last weekend, I wanted to implement <a href="https://shuheikagawa.com/blog/2020/01/26/responsive-images-with-a-static-site-generator/">responsive images</a>. One more Markdown-only feature. Then I thought it was time to convert the Textile files to Markdown.</p><h2>Converting Textile to Markdown</h2><p>I didn’t want to convert a hundred posts by hand. I had tried <a href="https://github.blog/2016-03-01-upgrading-your-textile-posts-to-markdown/">tomd</a> a few years ago, but I was not satisfied with the result. The old Textile files had raw HTML tags and some classes for styling. Also, I was afraid of missing some details that I don’t remember anymore. So I decided to write a conversion script.</p><p>I used <a href="https://github.com/borgar/textile-js">textile-js</a> to parse Textile. It turned out that <code>textile-js</code> output HTML string or <a href="http://www.jsonml.org/">JsonML</a>. JsonML was new to me. It is basically HTML in JSON format. Each text node is represented as a string. Each element node is represented as an array whose first item is the tag name, an optional second item is an object of attributes and the rest are child nodes.</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://foo.com"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"foo.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Foo"</span> /&gt;</span> Yay<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre><pre><code class="hljs json"><span class="hljs-punctuation">[</span>
  <span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span> <span class="hljs-attr">"href"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://foo.com"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">[</span><span class="hljs-string">"img"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"foo.png"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"alt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Foo"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-string">" Yay"</span>
<span class="hljs-punctuation">]</span>
</code></pre><p>I wrote a <code>switch</code> statement to handle tags and added tag handlers one by one.</p><pre><code class="hljs js"><span class="hljs-keyword">switch</span> (tag) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">"img"</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-comment">/* render &lt;img&gt; */</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">"a"</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-comment">/* render &lt;a&gt; */</span>;
  <span class="hljs-attr">default</span>:
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unknown tag: <span class="hljs-subst">${tag}</span>`</span>);
}
</code></pre><p>I also added <code>console.log</code> for unknown attributes. In this way, I was able to make sure that all tags and attributes were handled. <a href="https://github.com/shuhei/shuhei.github.com/pull/44">The script worked well to convert more than one hundred posts</a>. The full script is <a href="https://gist.github.com/shuhei/b622af9559d859d386edbfe43f171d72">on Gist</a>.</p></div></div></div><ul class="pagination"><li class="pagination__prev-page"><a href="/blog/pages/2/">Newer posts</a></li><li class="pagination__next-page"><a href="/blog/pages/4/">Older posts</a></li></ul><nav class="footer-nav"><a href="/blog/archives/">All posts</a></nav></div><footer class="footer">© Shuhei Kagawa</footer></div></body></html>