<!DOCTYPE html><html><head><title>Page 2 - Shuhei Kagawa</title><meta charset="utf-8"><meta name="viewport" content="initial-scale=1"><link rel="icon" sizes="16x16 32x32 48x48" href="/favicon.ico"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Asap:400,700"><link rel="stylesheet" href="/css/style.css"></head><body><header class="header"><h1 class="title"><a href="/">Shuhei Kagawa</a></h1><nav><ul><li><a href="/about">About</a></li><li><a href="/works">Works</a></li><li><a href="/blog/archives">Archives</a></li></ul></nav></header><div class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2015/02/15/playing-with-vanilla-webgl-api">Playing with vanilla WebGL API</a></h1><div class="meta">@<span class="date">2015-02-15 16:21</span> - <span class="category">JavaScript</span>, <span class="category">WebGL</span></div></div><div class="content"><p>Started writing in English on a whim.</p>
<p>I&#39;ve been learning vanilla WebGL with <a href="https://github.com/stackgl/webgl-workshop">webgl-workshop</a> since the last weekend. It took some time for me to understand concepts like array buffer and element buffer but it was fun to learn the basics that we stand on.</p>
<p>The team behind <a href="https://github.com/stackgl/webgl-workshop">webgl-workshop</a> creates a set of utility modules called <a href="http://stack.gl/"><code>stackgl</code></a>. It embraces the UNIX philosophy, &quot;Write programs that do one thing and do it well.&quot; Even though the workshop doesn&#39;t use <code>stackgl</code> libraries, I liked the way the exercises were organized as small modules.</p>
<p>Before moving to another workshop module, <a href="https://github.com/stackgl/shader-school">shader-school</a>, I ported my old openFrameworks experiment with vanilla WebGL and Audio User Media in order to check if I could use what I learned so far.</p>
<p><a href="/blurred-cube"><img src="/images/blurred-cube-webgl.png" alt="Blurred Cube"></a></p>
<p><a href="/blurred-cube">Blurred Cube</a></p>
<p>The hardest part was randomly moving the cube&#39;s edges. Because I couldn&#39;t randomly move vertices on the array buffer, I had to rewrite buffer data frame by frame. It might be inefficient, but it works well on my laptop at least.</p>
<h2 id="steps-for-drawing-with-webgl">Steps for drawing with WebGL</h2>
<p>The exercises on <a href="https://github.com/stackgl/webgl-workshop">webgl-workshop</a> split steps into two phases, <code>init</code> and <code>draw</code>, like <a href="https://processing.org/">Processing</a>. Here I leave a note on general steps in them for later use.</p>
<h3 id="init">Init</h3>
<ol>
<li>Compile shaders and link them into a program. If you have attributes in vertex shader, don&#39;t forget to set attribute location before linking. If you have uniforms, get their locations after linking for later use.</li>
<li>Create buffers and assign data to them.</li>
<li>Create element buffers and assign data to them if necessary.</li>
<li>Create textures and assign data to them if necessary. You can use textures in fragment shader via texture unit number as uniform.</li>
</ol>
<h3 id="draw">Draw</h3>
<ol>
<li>Use program, assign data to uniforms. If they don&#39;t change frame by frame, you can do this in the setup phase.</li>
<li>Bind buffer. If you have only one buffer, you may have done this in the setup phase.</li>
<li>Draw arrays or elements.</li>
</ol>
</div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2014/11/13/karma--to--preprocessor">karma-6to5-preprocessor</a></h1><div class="meta">@<span class="date">2014-11-13 23:35</span> - <span class="category">JavaScript</span>, <span class="category">Karma</span>, <span class="category">EcmaScript6</span></div></div><div class="content"><p>最近 <a href="https://github.com/6to5/6to5">6to5</a> を使って ES6 を書いています。ES6 を使うには Traceur Compiler なんかもありますが、クライアント側に結構重い runtime を入れる必要があって気が進みません。そこで runtime のいらない 6to5。</p>
<p>今作っているのは Angular アプリなので、テストは Karma。6to5 の Preprocessor が必要です。当然あるだろうと思って検索したのですが、ない。なかったので作りました。</p>
<p><a href="https://www.npmjs.org/package/karma-6to5-preprocessor">karma-6to5-preprocessor</a></p>
<p>ES6 で書いたスクリプトを Karma でテストすることができるようになります。Sourcemap を含めた設定例は README を見てみてください。</p>
<p>その後、ES6 Module も使うことにして、Browerify の transform として 6to5 と同じ作者が作っている <a href="https://github.com/6to5/6to5-browserify">6to5-browserify</a> を使うようにしました。すると Karma の方でも Browerify を使えばいいので karma-6to5-preprocessor は使う必要がなくなってしまったのです。結構需要がありそうなのに、何でなかったんだろうと思っていたのですが、これで謎がとけました。</p>
<p>それでも、ES6 Modules は使わないけど ES6 の便利な機能は使いたいという人はいるようで、ちょこちょこダウンロードされています。良かった良かった。</p>
</div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2014/09/27/land-prices-on-ios">WebGL な日本の地価マップをタッチ対応してみた</a></h1><div class="meta">@<span class="date">2014-09-27 16:53</span> - <span class="category">WebGL</span>, <span class="category">JavaScript</span></div></div><div class="content"><p>iOS 8 の Safari で WebGL が動くようになったので、以前作った日本の地価の 3D で表示するやつをタッチ対応してみました。</p>
<p><img src="/images/webland-ios.png" alt="Land Prices in Japan on iOS 8 Safari"></p>
<p><a href="/webland">Land Prices in Japan</a></p>
<p>ソースは <a href="https://github.com/shuhei/webland">GitHub にあります</a>。</p>
<p>タッチ対応というのは、大体以下のような感じです。</p>
<ul>
<li>Viewport が動かないように調整。</li>
<li>ドラッグで上下左右に動けるように。タッチデバイスかどうがで、タッチ系のイベントを使うかマウス系のイベントを使うかを切り替えています。</li>
<li>ピンチでズームできるように。難しいかなと思ったんですが、<code>gesturestart</code>, <code>gesturechange</code>, <code>gestureend</code> イベントがあったので簡単でした。</li>
<li>ダブルタップで視点を切り替えられるように。ダブルタップやダブルクリックのイベントというのは特にないので、<code>touchstart</code> の時に一個前のイベントの時刻と比較して判断しています。</li>
</ul>
<p>早速買い換えた iPhone 6 Plus でぬるぬる動く上に、iPhone 5 でも余裕で動きます。直接触れるので、画面は小さいものの PC より楽しいなあと思いました。今後はモバイルでの WebGL が面白そうですね。</p>
</div></div><ul class="pagination"><li class="prev-page"><a href="/">Newer Posts</a></li><li class="next-page"><a href="/blog/pages/3">Older Posts</a></li></ul></div><footer class="footer">&copy; Shuhei Kagawa<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-309586-8', 'shuheikagawa.com');
ga('send', 'pageview');</script></footer></body></html>