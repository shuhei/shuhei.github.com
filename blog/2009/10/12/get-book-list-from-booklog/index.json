{"site":{"title":"Shuhei Kagawa","author":"Shuhei Kagawa","perPage":3,"newPageExtension":"markdown","blogDir":"blog","sourceDir":"source","layoutDir":"_layouts","postDir":"_posts","cssFiles":["node_modules/highlight.js/styles/monokai-sublime.css","source/_css/style.css"]},"post":{"layout":"post","title":"Booklog から本一覧を取得","published":true,"date":"2009-10-12 22:10","comments":true,"tags":null,"categories":[],"url":"/blog/2009/10/12/get-book-list-from-booklog/","content":"<p><a href=\"http://booklog.jp/\">web 本棚サービス ブクログ</a> がリニューアルしたというので <a href=\"http://www.booklog.jp/users/branchiopoda\">再開しました</a> 。ペパボの公式サービスとなり、メンテナンスやサービスの追加をどんどんやって行くそうです。<br />\n今回のリニューアルで一番うれしいのが、本の登録機能の強化です。</p>\n<blockquote>\n<p>ご要望で最も多かったものの一つが、もっと本を簡単に登録したい！ １冊１冊登録するのが面倒くさい！というものでした。 今回のリニューアルでは、 ページ遷移をせずに、簡単に複数の本を登録できるように改善しています。</p>\n<p><a href=\"http://info.booklog.jp/?eid=78\"><cite>ブクログがリニューアルいたしました。 | ブクログお知らせブログ</cite></a></p>\n</blockquote>\n<p>さくさく登録できて素晴らしいです。</p>\n<p>今のところ <span class=\"caps\">API</span> はないようで、何かをしたいときにはスクレイピングする必要があります。<br />\nとりあえず Ruby で本の一覧を取得してみました。</p>\n<pre class=\"prettyprint\">require 'rubygems'\nrequire 'hpricot'\nrequire 'open-uri'\n\nclass Book\n  def initialize(title, url)\n    @title = title\n    @url = url\n  end\n  def asin\n    @url.split(\"/\").last\n  end\n  attr_accessor :title, :url\nend\n\ndef get_books(username)\n  doc = Hpricot(open(\"http://www.booklog.jp/users/#{username}/All?display=list\"))\n  books = []\n  (doc/\"div#shelf div.list ul li\").each do |book|\n    title = (book/:a).first.inner_html\n    url = (book/:a).first[:href]\n    books.push(Book.new(title, url))\n  end\n  books\nend\n\nbooks = get_books(\"branchiopoda\")\nbooks.each do |book|\n  puts \"#{book.title} =&gt; #{book.asin}\"\nend</pre>\n<p>一覧から取れるのはタイトルと <span class=\"caps\">ASIN</span> コードだけなので、それ以上の情報を得るには、個別のページや Amazon の <span class=\"caps\">API</span> を見る必要がありますね。一つ一つ見てゆくのは大変ですし、情報の更新も行いたいので、今後の <span class=\"caps\">API</span> の公開に期待です。</p>"}}