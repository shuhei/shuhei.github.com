{"site":{"title":"Shuhei Kagawa","author":"Shuhei Kagawa","perPage":3,"newPageExtension":"markdown","blogDir":"blog","sourceDir":"source","layoutDir":"_layouts","postDir":"_posts","cssFiles":["node_modules/highlight.js/styles/monokai-sublime.css","source/_css/style.css"]},"post":{"layout":"post","title":"Freeze panes with CSS and a bit of JavaScript","date":"2016-01-11 11:24","comments":true,"categories":["CSS","JavaScript"],"url":"/blog/2016/01/11/freeze-panes-with-css-and-a-bit-of-javascript/","content":"<p>People want fixed-header table. It reminds you what the columns are while you scroll down the table. There are a bunch of fixed-header-table tutorials out there. But most of them kill one of the greatest features of HTML table. The automatic sizing of cells according to their contents. This is because they usually prepare separate <code>&lt;table&gt;</code>s for header and body.</p>\n<p>Also, most of the tutorials only fix a header at the top. But my colleagues wanted more. They wanted to fix headers at the top and left. Just like <a href=\"http://www.gcflearnfree.org/excel2013/17\">Microsoft Excel&#39;s Freeze Panes feature</a>. So what we want now is:</p>\n<ol>\n<li>Automatic sizing of cells according to their contents</li>\n<li>Freeze panes</li>\n</ol>\n<p>We want to use only one <code>&lt;table&gt;</code> to easily achive the goal 1. But at the same time, we want to separate the movement of the headers from other cells to achieve the goal 2. Then <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/transform\">CSS3&#39;s <code>transform</code> property</a> came to my mind. It allows you to transform <strong>only rendering</strong> of an element without interfering its sibling nodes.</p>\n<p>So I gave it a shot and here&#39;s the result.</p>\n<p><a href=\"https://jsbin.com/katabi/edit\" target=\"_blank\">JS Bin on jsbin.com</a></p>\n<h2 id=\"transform-translate-\">transform: translate()</h2>\n<p>I used JavaScript to dynamically set <code>transform: translate(x, y);</code> to the header cells sending them back to the top/left edge of the container.</p>\n<pre><code class=\"hljs js\">container.addEventListener(<span class=\"hljs-string\">'scroll'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">var</span> x = container.scrollLeft;\n  <span class=\"hljs-keyword\">var</span> y = container.scrollTop;\n\n  leftHeaders.forEach(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">leftHeader</span>) </span>{\n    leftHeader.style.transform = translate(x, <span class=\"hljs-number\">0</span>);\n  });\n  topHeaders.forEach(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">topHeader, i</span>) </span>{\n    <span class=\"hljs-keyword\">if</span> (i === <span class=\"hljs-number\">0</span>) {\n      topHeader.style.transform = translate(x, y);\n    } <span class=\"hljs-keyword\">else</span> {\n      topHeader.style.transform = translate(<span class=\"hljs-number\">0</span>, y);\n    }\n  });\n});\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">translate</span>(<span class=\"hljs-params\">x, y</span>) </span>{\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'translate('</span> + x + <span class=\"hljs-string\">'px, '</span> + y + <span class=\"hljs-string\">'px)'</span>;\n}</code></pre><h2 id=\"border-collapse-separate-\">border-collapse: separate;</h2>\n<p>Another trick is <code>border-collapse: separate;</code>. We usually use <code>border-collapse: collapse;</code> for tables but it leaves borders behind the cells. With <code>border-collapse: collapse;</code>, we can make the borders transformed together with the header cells.</p>\n<pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">table</span> {\n  <span class=\"hljs-attribute\">border-collapse</span>: separate;\n  <span class=\"hljs-attribute\">border-spacing</span>: <span class=\"hljs-number\">0</span>;\n}\n\n<span class=\"hljs-selector-tag\">th</span>,\n<span class=\"hljs-selector-tag\">td</span> {\n  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#ccc</span>;\n  <span class=\"hljs-attribute\">border-right</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#ccc</span>;\n}</code></pre><h2 id=\"dummy-top-left-header-cell\">Dummy top left header cell</h2>\n<p>The last trick is a kind of shame. It&#39;s the top left header cell that should be fixed horizontally and vertically. We can achieve it by the <code>transform</code> property but the other top header cells hides it. I tried to make it rise with <code>z-index</code> but didn&#39;t work. So I created a dummy element that had the same size with the cell.</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">var</span> topLeft = <span class=\"hljs-built_in\">document</span>.createElement(<span class=\"hljs-string\">'div'</span>);\n<span class=\"hljs-keyword\">var</span> computed = <span class=\"hljs-built_in\">window</span>.getComputedStyle(columnHeaders[<span class=\"hljs-number\">0</span>]);\ncontainer.appendChild(topLeft);\ntopLeft.classList.add(<span class=\"hljs-string\">'top-left'</span>);\ntopLeft.style.width = computed.width;\ntopLeft.style.height = computed.height;</code></pre><pre><code class=\"hljs css\"><span class=\"hljs-selector-class\">.top-left</span> {\n  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#eee</span>;\n  <span class=\"hljs-attribute\">border-right</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#ccc</span>;\n  <span class=\"hljs-attribute\">border-bottom</span>: <span class=\"hljs-number\">1px</span> solid <span class=\"hljs-number\">#ccc</span>;\n  <span class=\"hljs-attribute\">box-sizing</span>: border-box;\n  <span class=\"hljs-attribute\">position</span>: absolute;\n  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;\n}</code></pre><h2 id=\"compatibility-and-performance\">Compatibility and performance</h2>\n<p>As far as I&#39;ve tested with the latest Chrome, Firefox and Safari on Mac, it worked well without any performance issue. I&#39;ll test it with more large table on other browsers including IE and add the result later.</p>\n"}}