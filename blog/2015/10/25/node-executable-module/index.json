{"site":{"title":"Shuhei Kagawa","author":"Shuhei Kagawa","perPage":3,"newPageExtension":"markdown","blogDir":"blog","sourceDir":"source","layoutDir":"_layouts","postDir":"_posts"},"post":{"layout":"post","title":"Node.js executable module","date":"2015-10-25 22:42","comments":true,"categories":["JavaScript"],"url":"/blog/2015/10/25/node-executable-module/","content":"<p>You may want to create a Node module that is also an executable. The convention is to create two files, one for lib and the other for bin, but I think it&#39;s OK for simple modules.</p>\n<p>To achieve it, you need to detect whether it&#39;s executed as an entry point. According to <a href=\"https://nodejs.org/api/modules.html#modules_accessing_the_main_module\">the official documentation of Node</a>:</p>\n<blockquote>\n<p>When a file is run directly from Node.js, <code>require.main</code> is set to its module. That means that you can determine whether a file has been run directly by testing</p>\n<pre><code class=\"hljs undefined\">require.main === module</code></pre></blockquote>\n<p>For example:</p>\n<pre><code class=\"hljs js\">#!/usr/bin/env node\n\nfunction sum(a, b) {\n  return a + b;\n}\n\nmodule.exports = sum;\n\nif (require.main === module) {\n  var a = parseInt(process.argv[2], 10);\n  var b = parseInt(process.argv[3], 10);\n  console.log(sum(a, b));\n}</code></pre><p>Then you can use it as an executable and a module.</p>\n<pre><code class=\"hljs sh\">$ node sum.js <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">4</span>\n<span class=\"hljs-number\">7</span>\n$ node\n&gt; require(<span class=\"hljs-string\">'./sum'</span>)(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>)\n<span class=\"hljs-number\">7</span></code></pre>"}}