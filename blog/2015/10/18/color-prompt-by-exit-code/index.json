{"site":{"title":"Shuhei Kagawa","author":"Shuhei Kagawa","perPage":3,"newPageExtension":"markdown","blogDir":"blog","sourceDir":"source","layoutDir":"_layouts","postDir":"_posts","cssFiles":["node_modules/highlight.js/styles/monokai-sublime.css","source/_css/style.css"]},"post":{"layout":"post","title":"Color prompt by exit code","date":"2015-10-18 19:11","comments":true,"categories":["Bash"],"url":"/blog/2015/10/18/color-prompt-by-exit-code/","content":"<p>The idea of customizing bash prompt hooked me a few months ago. I tried a few crazy things like <a href=\"https://github.com/shuhei/dotfiles/commit/a45d8c88d4c02737dad397b56624895bb715f5b5\">showing random emojis</a> and finally settled down with just showing the current directory, git branch and status.</p>\n<p>At <a href=\"http://nodejs.connpass.com/event/20646/\">Tokyo Node Gakuen #18</a> on October 8th, <a href=\"https://twitter.com/yosuke_furukawa\">@yosuke_furukawa</a> <a href=\"https://speakerdeck.com/yosuke_furukawa/node-dot-js-v4-falsehua-number-tng18\">talked about Node.js v4.0</a>. Aside from the well-organized and informative talk, I found another interesting thing at his demo. His terminal prompt <em>turned red when a command failed</em>.</p>\n<p>It looked pretty and useful. So I emulated it.</p>\n<p><img src=\"/images/prompt-exit-code.gif\" alt=\"Changing prompt color \"></p>\n<p>The code in <code>.bash_profile</code> is pretty straightforward. It changes the prompt color depending on whether the exit code is 0 or not. The only one trick is to capture the exit code at the very first line of the prompt command to prevent it from being changed in prior lines.</p>\n<pre><code class=\"hljs sh\"><span class=\"hljs-comment\"># Colors</span>\nlight_green=<span class=\"hljs-string\">\"\\[\\e[1;32m\\]\"</span>\nlight_red=<span class=\"hljs-string\">\"\\[\\e[1;31m\\]\"</span>\nyellow=<span class=\"hljs-string\">\"\\[\\e[0;33m\\]\"</span>\ngray=<span class=\"hljs-string\">\"\\[\\e[0;37m\\]\"</span>\nreset=<span class=\"hljs-string\">\"\\[\\e[m\\]\"</span>\n\n<span class=\"hljs-comment\"># Customize prompt</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">prompt_command</span></span>() {\n  <span class=\"hljs-built_in\">local</span> status=<span class=\"hljs-string\">\"$?\"</span>\n  <span class=\"hljs-built_in\">local</span> status_color=<span class=\"hljs-string\">\"\"</span>\n  <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">$status</span> != 0 ]; <span class=\"hljs-keyword\">then</span>\n    status_color=<span class=\"hljs-variable\">$light_red</span>\n  <span class=\"hljs-keyword\">else</span>\n    status_color=<span class=\"hljs-variable\">$light_green</span>\n  <span class=\"hljs-keyword\">fi</span>\n  <span class=\"hljs-built_in\">export</span> PS1=<span class=\"hljs-string\">\"[<span class=\"hljs-variable\">${yellow}</span>\\w<span class=\"hljs-variable\">${reset}</span>]<span class=\"hljs-variable\">${gray}</span><span class=\"hljs-variable\">$(__git_ps1)</span><span class=\"hljs-variable\">${reset}</span> <span class=\"hljs-variable\">${status_color}</span>Î»<span class=\"hljs-variable\">${reset}</span> \"</span>\n}\n<span class=\"hljs-built_in\">export</span> GIT_PS1_SHOWDIRTYSTATE=1\n<span class=\"hljs-built_in\">export</span> PROMPT_COMMAND=prompt_commandsh</code></pre><p>One of the advantages of attending real events over just browsing slides online is being able to take a peek of other people&#39;s dev environments. Looking forward to seeing more cool stuff on upcoming events like <a href=\"http://nodefest.jp/2015/\">Tokyo Node Fest 2015</a>.</p>\n"}}