<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="preload" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff" as="font" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><meta name="viewport" content="width=device-width,initial-scale=1"><title>Shuhei Kagawa</title><link rel="icon" sizes="16x16 32x32 48x48" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="Atom feed of Shuhei Kagawa" href="/blog/feed.xml"><style>:root{--bg-color:#f9f9f9;--text-color:#222;--highlight-color:#095ae8;--code-text-color:var(--code-mono-1);--code-bg-color:#fff;--syntax-hue:230;--syntax-saturation:1%;--syntax-brightness:100%;--code-mono-1:hsl(var(--syntax-hue),8%,24%);--code-mono-2:hsl(var(--syntax-hue),6%,44%);--code-mono-3:hsl(var(--syntax-hue),4%,64%);--code-hue-1:#0184bc;--code-hue-2:#1d56d3;--code-hue-3:#a626a4;--code-hue-4:#188816;--code-hue-5:#ce3527;--code-hue-5-2:#ca1243;--code-hue-6:#986801;--code-hue-6-2:#986801;--body-font-family:"Libre Baskerville",serif;--heading-font-family:"Libre Franklin",sans-serif;--code-font-family:"DM Mono",monospace}body{background:#f9f9f9;background:var(--bg-color);color:#222;color:var(--text-color);font-family:Libre Baskerville,serif;font-family:var(--body-font-family);font-size:16px;line-height:1.9;margin:0;padding:0}.container{margin:0 auto;padding:0 20px;width:700px}a{color:#095ae8;color:var(--highlight-color);text-decoration:none;transition:color .5s ease}a:hover{text-decoration:underline}.header{display:flex;padding:1.5em 0 1em}.header__title{flex-grow:1;font-size:1em;font-weight:400;margin:0 10px 0 0}.header__title a{color:#222;color:var(--text-color)}.header__nav{flex-grow:0}.menu{list-style-position:outside;list-style-type:none;margin:0;padding:0;text-align:right}.menu__item{display:inline-block;padding:0 0 0 .7em}.menu__item a{color:#222;color:var(--text-color)}.footer{padding:3em 0 4em;text-align:center}.title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:3em;line-height:1.1;margin:0 0 .2em}.title a{color:#222;color:var(--text-color);text-decoration:none}.post,.post-list{padding:1.7em 0 1.25em}.post:after{content:"* * *";display:block;font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:4.5em;font-weight:700;line-height:1;margin:.9em auto 0;text-align:center}.post .meta{font-size:.75em}.post-list .title{margin-bottom:10px}.post-list-item{display:flex;line-height:1.6em;padding:10px 0}.post-list-item__date{flex-shrink:0;font-size:.8em;width:8em}.post-list-item__title{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);font-size:1.3em;font-weight:700;margin:0}.post-list-item__title a{color:#222;color:var(--text-color);text-decoration:none}.content h2,.content h3,.content h4,.content h5,.content h6{font-family:Libre Franklin,sans-serif;font-family:var(--heading-font-family);margin:1em 0 0}.content h2{font-size:2.2em;line-height:1.1}.content h3{font-size:1.6em;line-height:1.3}.content h4{font-size:1.2em}.content img{height:auto;max-width:100%}.content p{margin:1.15em 0}.img-wrapper{display:block;text-align:center}.comments{margin-bottom:3em}ol,ul{list-style-position:outside;padding-left:1.4em}.table-wrapper{margin:1.15em 0;overflow-x:auto}.table-wrapper table{border-collapse:collapse;margin:0;width:100%}tr{vertical-align:top}th{font-weight:400;text-align:left}tbody{border-bottom:1px solid #333;border-top:1px solid #333;padding:.5em 0}td,th{padding-right:1em}code{background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);font-family:DM Mono,monospace;font-family:var(--code-font-family);font-size:.9em;padding:0 .3em}.code__filename{background-color:#666;display:inline-block;font-size:.85em;margin-bottom:13px;padding:5px 10px}.hljs{-webkit-overflow-scrolling:touch;background-color:#fff;background-color:var(--code-bg-color);color:#383a42;color:var(--code-text-color);display:block;line-height:1.5em;overflow-x:auto;padding:1em 20px}.hljs-comment,.hljs-quote{color:#696c77;color:var(--code-mono-2);font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--code-hue-3)}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ce3527;color:var(--code-hue-5)}.hljs-literal{color:#0184bc;color:var(--code-hue-1)}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#188816;color:var(--code-hue-4)}.hljs-built_in,.hljs-class .hljs-title{color:#986801;color:var(--code-hue-6-2)}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--code-hue-6)}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#1d56d3;color:var(--code-hue-2)}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}blockquote{font-style:italic;margin:1.5em 0;padding:0 0 0 2em}blockquote p:first-child:before{content:open-quote;font-family:serif;font-size:3em;font-weight:700;line-height:.1em;margin-right:.2em;vertical-align:-.4em}blockquote cite{color:#999990}blockquote cite:before{content:"- "}.pagination{display:flex;justify-content:space-between;list-style-position:outside;list-style-type:none;margin-top:20px;padding:0}.pagination__next-page,.pagination__prev-page{width:46%}.pagination__next-page{text-align:right}.footer-nav{text-align:center}@media only screen and (max-width:767px){body{font-size:15px;line-height:1.65}.container{width:auto}.post,.post-list{padding-top:10px}.post-list-item{display:block}.hljs{border-radius:0;margin-left:-20px;margin-right:-20px;padding:1.4em 20px}li .hljs{margin-left:0}.img-wrapper{margin-left:-20px;margin-right:-20px}}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthSQBK6PYK3EXw.woff2) format("woff2");unicode-range:u+0100-02af,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:DM Mono;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYthqQBK6PYK0.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWx8QDO-WyrubOA.woff2) format("woff2");unicode-range:u+0100-02af,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKhZrc3Hgbbcjq75U4uslyuy4kn0qNcWxEQDO-Wyrs.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNXaxMaC82U-ro.woff2) format("woff2");unicode-range:u+0100-02af,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Baskerville;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/librebaskerville/v14/kmKnZrc3Hgbbcjq75U4uslyuy4kn0qNZaxMaC82U.woff2) format("woff2");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkD9DPTedX18mETQw.woff) format("woff");unicode-range:u+0102-0103,u+0110-0111,u+0128-0129,u+0168-0169,u+01a0-01a1,u+01af-01b0,u+1ea0-1ef9,u+20ab}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkDtDPTedX18mETQw.woff) format("woff");unicode-range:u+0100-02af,u+1e??,u+2020,u+20a0-20ab,u+20ad-20cf,u+2113,u+2c60-2c7f,u+a720-a7ff}@font-face{font-display:swap;font-family:Libre Franklin;font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/librefranklin/v13/jizOREVItHgc8qDIbSTKq4XkRg8T88bjFuXOnduhycKkANDPTedX18mE.woff) format("woff");unicode-range:u+00??,u+0131,u+0152-0153,u+02bb-02bc,u+02c6,u+02da,u+02dc,u+2000-206f,u+2074,u+20ac,u+2122,u+2191,u+2193,u+2212,u+2215,u+feff,u+fffd}</style><meta name="description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@shuheikagawa"><meta property="og:title" content="Shuhei Kagawa"><meta property="og:site_name" content="Shuhei Kagawa"><meta property="og:description" content="A personal website of Shuhei Kagawa. I write mostly on web technologies and life."></head><body><div class="container"><header class="header"><h1 class="header__title"><a href="/">Shuhei Kagawa</a></h1><nav class="header__nav"><ul class="menu"><li class="menu__item"><a href="/about/">About</a></li><li class="menu__item"><a href="/blog/archives/">All posts</a></li></ul></nav></header><div class="main"><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2023/01/03/2022-in-review/">2022 in review</a></h1><div class="meta"><span class="date">Jan 3, 2023</span> - <a href="/blog/tags/Review">Review</a></div></div><div class="content"><div><p>TODO: Title image</p><p>It’s already April. You may think that it’s too late to publish a review of 2022. But you know, fiscal years and school years start in April in my home country. So it’s not unusual for me to publish this now.</p><h2>Becoming a parent</h2><p>I became a father in the winter of 2022. Before the birth, I was preoccupied by the birth itself. I wan’t well prepared for taking care of the baby when the baby came to the world.</p><p>I often focus on one thing at a time and put off the other things. It’s one of my superpowers that helped me arrive where I am. At the same time, I felt that I missed many important things because of this tendency. I hope parenting teaches me how to balance better.</p><h2>Coffee</h2><p>After I wrote <a href="/blog/2021/02/10/making-coffee/">a blog post on making coffee at home</a>, coffee has turned into a good hobby. I upgraded my equipment: Flair 58, Comandante C40 and NanoFoamer. I practiced latte art every day and started to see some improvements.</p><p>TODO: Images of before and after</p><h2>Books</h2><p>I mostly read technology and non-fiction books in the last several years in the spirit of <em>truth is stranger than fiction</em>. I did differently in 2022. I read novels. I probably missed human interactions. Novels have filled them in a way.</p><p>Also I learned statistics at the beginning of the year. A Coursera course. The O’Reilly book: Practical Statistics for Data Scientists.</p><h2>Side project</h2><p>I enjoyed building a toy browser following <a href="https://browser.engineering">the Web Browser Engineering book by Pawel and Chris</a>. You can read <a href="/blog/2022/06/03/toy-browser/">my previous blog post</a> for more about it.</p><h2>Travels</h2><p>We didn’t make long travels after my wife got pregnant. We made short trips to France and Germany, a few days in Paris and Berlin each. Day trips to Colmar in Alsas and Constants. I made a spontaneous cycling from Zurich to the German border and came back by train.</p><p>I visited places near Zurich. Zug, Einsiedeln, Winterthur, Rapperswil, Stein am Rhein. Visited Jona a few times for amazing ramen at Ninja Noodles. And enjoyed the view from Uetliberg several times.</p><h2>Work</h2><p>The time has finally come. Return to office. I enjoyed working from office after a long time. I even had a work boat party on the Zurich lake. But I caught COVID-19 twice in a row in July and August, and then started working from home again.</p><p>I have been in the same team for 2 years. Still not very confident about the tech stack, but fake it until make it…</p><h2>Conclusion</h2><p>My biggest change in 2022 (and the last few years) was becoming a parent. I’m looking forward to what’s to come in upcoming years!</p></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2022/06/03/toy-browser/">Building a toy browser</a></h1><div class="meta"><span class="date">Jun 3, 2022</span> - <a href="/blog/tags/Browser">Browser</a>, <a href="/blog/tags/CSS">CSS</a>, <a href="/blog/tags/Python">Python</a></div></div><div class="content"><div><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/Y_8TV1J_G2-700.avif 700w, /cached/Y_8TV1J_G2-900.avif 900w, /cached/Y_8TV1J_G2-1100.avif 1100w, /cached/Y_8TV1J_G2-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/Y_8TV1J_G2-700.webp 700w, /cached/Y_8TV1J_G2-900.webp 900w, /cached/Y_8TV1J_G2-1100.webp 1100w, /cached/Y_8TV1J_G2-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/png" srcset="/cached/Y_8TV1J_G2-700.png 700w, /cached/Y_8TV1J_G2-900.png 900w, /cached/Y_8TV1J_G2-1100.png 1100w, /cached/Y_8TV1J_G2-1400.png 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Screenshot of my toy browser showing this website" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAYAAADam2dgAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVQYlQEDAfz+AOHh4cPi4uO04+Pkt+Dh4bfi4uO34uLjt+Lj47Xj4+TA2dnZSAD19fX/6Ojn/+Tk4//k5OT/5ubm/+3s7P/z8vL/9PT0/+fn5msA+/v7/+Lk5vjj5uf87u/v/Ozt7vz3+vz8/f7/+fj4+P/s7OxlAPr6+//ezsT7ybKn/p+Zmf6qoZz+1Lyt/ufb1Pz6/P3/6unoZgD6+/z/xqeV925NPPuAaE37f2lO+35YQ/rYv7H4/P///+Ph4GQA/v///7adkf9rTTb/rsbA/6Osm/9qSDL/0r6z//7////m5ONtAN7g4IyiiXuCUzwvhHyRj4Rufn2EVzkohLmmm4Lh5OWKzs3MNB/Ox500qqKLAAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/Y_8TV1J_G2-700.png" width="1400" height="1003"></picture></span></p><p>In the last several weeks, I have been building a toy browser based on an online book, <a href="https://browser.engineering">Web Browser Engineering</a>. As someone who spent a fair share of his career on web frontend, it was eye-opening and satisfying. It felt like I had been living on one side of a wall for years and finally visited the other side of the wall. I imagine other web frontend folks would like it as well.</p><h2>The book</h2><p><a href="https://browser.engineering/">Web Browser Engineering</a> is an online book by Pavel Panchekha and Chris Harrelson. It explains how browsers work and lets you implement a toy browser almost from scratch. HTTP, CSS parser, HTML parser, rendering pipeline (style, layout, paint), the interaction between browser window and tabs, JavaScript, animation, and the list goes on. It uses only a handful of libraries such as TCP, Tkinter (replaced by Skia and SDL in later chapters), and dukpy.</p><p>I discovered it on Twitter. Once I started reading the book, I was hooked. It presents succinct code to implement browser features incrementally. You are always with working code.</p><p>Each topic lays a good foundation that you can build upon and links to relevant resources. Exercises let you implement features on your own.</p><p>Even before the book, I had read a good amount of articles about how browsers work <em>from outside</em>. The book explained concepts in a way that readers could implement them. I learned a lot.</p><h2>Beyond the book</h2><p>I wanted to render real-world websites. Well, real-world websites on the simpler side. Not JavaScript-driven applications. HTML, CSS, and a bit of JavaScript. This website and the book's website were my main targets. Wikipedia was a stretch goal.</p><p>The goal has been partially achieved.</p><iframe style="width: 100%; aspect-ratio: 1280 / 880;" src="https://www.youtube-nocookie.com/embed/xlWsv1C6VOA?mute=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><p>Even for rendering simple websites, I had to implement or revamp numerous browser features beyond the book.</p><h3>HTML</h3><p>I revamped the recursive descent HTML parser from the book to support quoted attributes, raw text elements, etc. Among HTML, CSS, and JavaScript (ECMAScript), the HTML spec was the easiest to read and implement (partially).</p><p>Fun facts:</p><ul><li><a href="https://html.spec.whatwg.org/multipage/parsing.html#determining-the-character-encoding">Browsers are supposed to <em>sniff</em> the character encoding of a web page</a>.</li><li><a href="https://html.spec.whatwg.org/multipage/syntax.html#optional-tags">HTML spec has quite detailed rules for tag omission</a>.</li><li><a href="https://html.spec.whatwg.org/multipage/parsing.html#an-introduction-to-error-handling-and-strange-cases-in-the-parser">HTML spec explains how to handle invalid markups</a> like <code>&lt;b&gt;&lt;i&gt;&lt;/b&gt;&lt;/i&gt;</code>. HTML parser never fails!</li></ul><h3>CSS and rendering</h3><p>I was drawn to implementing CSS features. CSS is more forgiving than JavaScript—at least for a toy browser. Even if my toy browser missed most of the CSS features, it still rendered something on the screen. On the other hand, JavaScript halts execution on a single missing syntax or feature. I would need to implement a bunch of browser APIs until the toy browser could run real-world scripts. So, I focused on CSS and rendering for the toy browser.</p><p>While I was working on the project, my best friends were <a href="https://developer.mozilla.org">MDN</a> and CSS specs (<a href="https://www.w3.org/TR/CSS22/">CSS 2</a> and <a href="https://www.w3.org/Style/CSS/specs.en.html" title="All CSS specifications">more</a>). Yes, there are quite readable.</p><p>One surprise for me was that CSS syntax doesn’t say much about property values. Each property has own syntax. For example, <code>font-family</code> and <code>animation</code> have different precedence rules for commas and spaces.</p><p><code>font-family</code> puts commas higher precedence than spaces:</p><pre><code class="hljs css"><span class="hljs-comment">/* (1.6em) (bold) (Helvetica, Arial, sans-serif) */</span>
<span class="hljs-attribute">font-family</span>: <span class="hljs-number">1.6em</span> bold Helvetica, Arial, sans-serif;
</code></pre><p><code>animation</code> does the other way around:</p><pre><code class="hljs css"><span class="hljs-comment">/* (slidein 3s), (move 10s) */</span>
<span class="hljs-attribute">animation</span>: slidein <span class="hljs-number">3s</span>, move <span class="hljs-number">10s</span>;
</code></pre><p>The book skipped whitespace handling but it was necessary for nice-looking code blocks (<code>white-space: pre</code>). The CSS spec has <a href="https://www.w3.org/TR/css-text-3/#white-space-rules">elaborate rules for ignoring and collapsing whitespace</a>. I made up a greedy algorithm instead of implementing the full spec. It's not 100% accurate, but it looks alright.</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/K4c4VxcKAV-700.avif 700w, /cached/K4c4VxcKAV-900.avif 900w, /cached/K4c4VxcKAV-1100.avif 1100w, /cached/K4c4VxcKAV-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/K4c4VxcKAV-700.webp 700w, /cached/K4c4VxcKAV-900.webp 900w, /cached/K4c4VxcKAV-1100.webp 1100w, /cached/K4c4VxcKAV-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/png" srcset="/cached/K4c4VxcKAV-700.png 700w, /cached/K4c4VxcKAV-900.png 900w, /cached/K4c4VxcKAV-1100.png 1100w, /cached/K4c4VxcKAV-1400.png 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Screenshot of the toy browser showing a page with code blocks" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAYAAADam2dgAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVQYlT2OTWrEMAyFfageogdpuym9xDCrocdpybbQ7HICE8IEa9Kx82OTiGA7DlZRoF18vMdD0pO4ttdvpeBDa13cbl3RdT/F/X74TwD4klI+CmMMaa3JOUfW2n/13lOMkYZheBUcKoAAADujtd77vt+JKBIRLzyLeZ7JGJPGcczMNE3ZWsu6IyIty/IiNr+Rs86HEFLO+Y8NEQNXIuKTiCHy9NHPpJS45fiNL63r+ibqun6XUp6UUue2bQ/Yl2V5qqrq0jTNwy+R1uJk/zd2twAAAABJRU5ErkJggg=='%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/K4c4VxcKAV-700.png" width="1400" height="1003"></picture></span></p><p>Web fonts were essential to make my toy browser look nice. I revamped the CSS parser to support the <code>@font-face</code> rule and implemented rudimentary font synthesis and font matching. Skia took care of the actual rendering.</p><p>I also learned a few things about the inline layout (or normal flow). The box model is considered to be a basic for frontend developers. But did you know how the inline layout works? What's the difference between <code>line-height: 1</code> and <code>line-height: 1em</code>? Why doesn't vertical-align help vertical centering? <a href="https://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align">Deep dive CSS: font metrics, line-height and vertical-align</a> by Vincent De Oliveira is an amazing article that explains those things.</p><p>Fun facts:</p><ul><li><a href="https://www.youtube.com/watch?v=Y5Xa4H2wtVA" title="BlinkOn 8: Block Layout Deep Dive">Margin collapsing and float are hilariously complex</a>. I implemented only a tip of them.</li><li><a href="https://www.w3.org/TR/css-fonts-4/#font-style-matching">CSS Fonts Module</a> has line charts to explain the font matching algorithm. Browsers try their best to pick fonts for you without you even noticing it.</li><li><a href="https://www.w3.org/TR/css-lists-3/">The list counter spec</a> is quite advanced. You can create counters, increment them and use them as part of <code>content</code> in CSS.</li></ul><h3>Other stuff</h3><p>I also implemented other stuff.</p><ul><li>Retina display to make the toy browser look good on my laptop</li><li>Window resizing: SDL doesn’t seem to provide a good API for resizing</li><li>URL parsing: Parsing URLs into objects made it easier to implement many other parts of the project. I should have done it earlier.</li><li>Content Security Policy: The CSP implementation from the book blocks legitimate requests. I implemented the bare minimum to allow legitimate resource loading.</li></ul><h2>Python</h2><p>The book uses Python for <a href="https://browser.engineering/blog/why-python.html" title="Why Python? | Web Browser Engineering">good reasons</a>. I followed the path and used Python because I wanted to focus on the subject instead of spending time on <em>how to do X in Y language</em>. I had already made enough (fun) mistakes of this kind in my life.</p><p>Also, it was a good opportunity for me to learn Python. Python is used in a lot of places now, but I had survived without learning it before the project. After writing thousands of lines, I like its concise syntax.</p><p>I used <a href="https://github.com/microsoft/pyright">pyright</a> for static type-checking along with <a href="https://github.com/fannheyward/coc-pyright">coc-pyright</a> on Vim. Its type inference worked quite well for me. It uses a gradual typing approach similar to TypeScript although Python’s type annotation is part of the language specification. Python’s typing features don’t look as powerful as TypeScript, but they met more than 90% of my needs. Also, auto-completion was helpful for a Python beginner.</p><p>My toy browser uses only a handful of third-party libraries. They either had type annotations or had only small little surface in my toy browser. The only exception was <a href="https://github.com/kyamagu/skia-python">skia-python</a>. I used it a lot. It didn’t have official type stubs, so <a href="https://github.com/kyamagu/skia-python/issues/133#issuecomment-1066141203">I generated them with mypy's stubgen</a>. The generated stubs were not perfect but good enough as a foundation to build upon for my limited use case.</p><p>I used <a href="https://github.com/psf/black">black</a> for code formatting and <a href="https://github.com/pytest-dev/pytest/">pytest</a> for unit testing. I don't have much to say about them because they <em>just worked™</em>.</p><h2>Conclusion</h2><p>It’s been a fun side project with lots of learning. I imagine other web frontend folks would like it as well. I recommend you check out <a href="https://browser.engineering" title="Web Browser Engineering">the book</a> and build your own toy browser!</p></div></div></div><div class="post"><div class="post-header"><h1 class="title"><a href="/blog/2021/12/31/2021-in-review/">2021 in review</a></h1><div class="meta"><span class="date">Dec 31, 2021</span> - <a href="/blog/tags/Review">Review</a></div></div><div class="content"><div><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/EFLvHf52dT-700.avif 700w, /cached/EFLvHf52dT-900.avif 900w, /cached/EFLvHf52dT-1100.avif 1100w, /cached/EFLvHf52dT-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/EFLvHf52dT-700.webp 700w, /cached/EFLvHf52dT-900.webp 900w, /cached/EFLvHf52dT-1100.webp 1100w, /cached/EFLvHf52dT-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/EFLvHf52dT-700.jpeg 700w, /cached/EFLvHf52dT-900.jpeg 900w, /cached/EFLvHf52dT-1100.jpeg 1100w, /cached/EFLvHf52dT-1400.jpeg 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="A view from a lift in Amden" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQImQHEADv/AF1rhX+RtY2gxJapyJWoyJSmwqG20ae92a3D4QB2f3x4goOAjZSPnq2WpLWEkKGwv9bC0urH2O0AY2pQYGZQdnhmZWhcdHlfcXhjiZB3jpaFhIuCAIuRSXuCRF9jTY6PVouPRoeJS5OVR5WXRF1eNgBwdUyDhFx8gFGEi0tudT1scjyMkkt8fkc0OB0AYWU5bWxFfntZioJqTEk3SUkmhXxpQT09AgQEAISGQ3+CQWVqNDlAKR4iGCknGSwqHwsLCQgIByR6U8OlqiutAAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/EFLvHf52dT-700.jpeg" width="1400" height="1050"></picture></span></p><p>I turned 40 this year. I've lived roughly half of my life—in a happy case. If time gets faster as we age, it'd be more than half. But 2021 didn't feel short to me, probably thanks to a lot of changes this year.</p><h2>Move</h2><p>My biggest event this year was the move to Switzerland. In December 2020, I started working remotely from Berlin for a team in Zürich. Then I flew into Zürich at the end of March and moved into my current apartment in June.</p><p>International moves are not easy, but everything felt three times harder during the pandemic. We terminated numerous contracts by letter/phone/email, packed books and furniture, gave away the rest, emptied the apartment in Berlin, and departed from the new BER airport. I didn't say goodbye in person to most of my friends in Berlin. We checked into a temporary apartment, found a long-term apartment, bought furniture piece by piece. We finally felt we settled down in the autumn.</p><h2>Zürich</h2><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/2FBedJuQfK-700.avif 700w, /cached/2FBedJuQfK-900.avif 900w, /cached/2FBedJuQfK-1100.avif 1100w, /cached/2FBedJuQfK-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/2FBedJuQfK-700.webp 700w, /cached/2FBedJuQfK-900.webp 900w, /cached/2FBedJuQfK-1100.webp 1100w, /cached/2FBedJuQfK-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/2FBedJuQfK-700.jpeg 700w, /cached/2FBedJuQfK-900.jpeg 900w, /cached/2FBedJuQfK-1100.jpeg 1100w, /cached/2FBedJuQfK-1400.jpeg 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Sun and alps over the Limmat river and the Zürich lake" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQImQHEADv/AGGGumWJvWuPw5aw5JCs3myPxWaKvmGFuVp9sABjh7pxmtNsltCgvuWaueNxm9Z0m9Jvls1qkcsAPEtjdJbGia/gi7PljLTmi7Pmh6/kfKPXYoCqAB0aHUtPWnaBlZyrxJeqyHOHo2FviEtSYUBARAAlKTFTZ4Vphax4krh4lr5qibNYbY5NWnFFSE8AISk1TmqPWHqkfJS0bIesVnaeXXuiV3KYP1FvACo1STVIZTRKaYOLn1tshTFIaDVIZDZHYjdIY+oCXifSFFd0AAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/2FBedJuQfK-700.jpeg" width="1400" height="1050"></picture></span></p><p>Zürich is small. Almost everything is within walking distance. It doesn't have as many trees and parks as Berlin does, but the Zürich lake and mountains are nearby. You can see snow-crowned alps across the lake. My biggest complaint is that most of the streets and sidewalks are covered with asphalt. They are good when you carry suitcases, but I don't like how they look.</p><p>People here seem to be early birds. Streets become noisy around 7 a.m., so I had to adjust myself to become an early bird. I go for a walk after 9 a.m., and parks and coffee shops are almost empty where I'd see more people in Berlin. On the other hand, cafes and bars get full of people enjoying <em>apéro</em> in the late afternoon, especially in summer.</p><p>It's expensive to eat out here—twice or more of Berlin. I haven't tried many because of the pandemic and the price. On the other hand, more Japanese groceries are available here. Also, I'm happy that supermarket chains sell sashimi-quality salmon and tuna. Especially, Migros' salmon is amazing.</p><h2>Language</h2><p>Even though Zürich is a German-speaking city, many people speak fluent English. It feels much easier to live here without speaking German than in Berlin. But this situation of no pressure somehow motivated me. I started learning German again with Duolingo.</p><p>I learned some Swiss-German phrases like <em>merci vielmal</em> meaning <em>thank you very much</em>. Such a nice expression of multilingualism. Also, I learned that the <em>-li</em> suffix was Swiss German. The most famous one would be muesli (<em>Müsli</em>), and some of you may know the compression algorithm Brotli (<em>Brötli</em>).</p><h2>Travels</h2><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/UbTlckszgB-700.avif 700w, /cached/UbTlckszgB-900.avif 900w, /cached/UbTlckszgB-1100.avif 1100w, /cached/UbTlckszgB-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/UbTlckszgB-700.webp 700w, /cached/UbTlckszgB-900.webp 900w, /cached/UbTlckszgB-1100.webp 1100w, /cached/UbTlckszgB-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/UbTlckszgB-700.jpeg 700w, /cached/UbTlckszgB-900.jpeg 900w, /cached/UbTlckszgB-1100.jpeg 1100w, /cached/UbTlckszgB-1400.jpeg 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Matterhorn and its reflection on a lake" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQImQHEADv/AHCg8XOe5W+Z3WSQ1VmGzFF7wUlzt0hws0dusABRcaVvovJvovFsnepqmuVhjthZhtFbiNJYhdAAHyUtO09ubZzfa5bXb53ifrL/gK32eKXudJveAEZMWDY5QTI7R1dhc1hmf2l/oV9zk2h4k2FlcQBBREBIS0k/VG9NYXtQZ4dcfatgeqBzfIZtbmgAJDAuPFNsTG6ZRWGGRWGFSGSISWSHYm96ZWlmADtMXzxOZTpJWT1LVzxIUTdETTdDSzdETTpHT7hlVUm6CQGnAAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/UbTlckszgB-700.jpeg" width="1400" height="1050"></picture></span></p><p>I got a new hobby, hiking. Well, I had to, because it's Switzerland. Starting from Uetliberg—Zürich's <a href="https://en.wikipedia.org/wiki/Hausberg"><em>Hausberg</em></a>—I hiked on Rigi, Pfannelstiel, Lägern, Pilatus, Zermatt, Amden, and Sihlwald.</p><p>The Swiss government provides an impressive map website/app called <a href="https://www.schweizmobil.ch/en/hiking-in-switzerland.html">SwitzerlandMobility</a>. It shows everything necessary for hiking and allows you to plan your next trip.</p><p>In addition to mountains, I visited several Swiss cities: Luzern, Rapperswil, Basel, Bern, Lugano, and Neuchâtel. They were all small and walkable. Before my move, I didn't know that there were many medieval towns in Switzerland. It was fun to walk through Switzerland, Germany, France, and Switzerland again in Basel.</p><p>I was able to travel a lot because Swiss transportation is great and the land is small. In terms of area, Switzerland is only 40% bigger than Brandenburg and half of Hokkaido.</p><h2>Food and drinks</h2><p>I've been exploring the famous Swiss Cheese. Emmentaler, Appenzeller, Gruyere, Vacherin, and so on. I learned that Parmigiano Reggiano was not necessarily the best cheese in the world.</p><p>Also, I almost stopped drinking alcohol, including beer. Instead, I've been practicing latte art and drinking coffee every day.</p><h2>Social media</h2><p>I'm trying to reduce my usage of social media. Sometime this year, I realized that I was spending more than 3 hours every day on Twitter. That was horrific. In addition, social media timelines show less and less content from my actual friends. They show recommendations and content that my friends <em>liked</em>. I tried to limit time first, but it didn't work. So, I just stopped using them altogether for a few months. It felt great. I got more time to read books and became attentive to what was going on around me.</p><h2>Books</h2><p>I bought roughly 60 books, <a href="https://www.goodreads.com/user/year_in_books/2021/57764964">read 12 of them</a>, and half-read several more. I couldn't read much around the move but started picking up in the winter. I especially liked that <em>Tyranny of Merit</em> and <em>Four Thousand Weeks</em> made me step back and think about how to spend the rest of my life.</p><h2>Work</h2><p>It's been a year since I started my current job. It took me the whole year to feel comfortable with it. My managers told me I was doing fine, but I didn't feel I was catching up fast enough. The tech stack was completely new to me. It was hard to focus on work for the few months around the move. Imposter syndrome was real. Working from home didn't help here.</p><p>Fortunately, it gradually improved. I was able to focus again after settling down in my current apartment. I slowly felt belonged when I commuted to the office and met teammates in person. My starter project turned out to be more complex than I expected, but I'm happy that I finished it. I started getting some other responsibilities. There's still a long way to go, but now I feel I can do <em>something</em>.</p><h2>Conclusions</h2><p>In 2021, I moved to a new country, settled down at home and work, traveled a lot, and had some chance to step back and reflect. I'm looking forward to what's to come in 2022!</p><p><span class="img-wrapper"><picture><source type="image/avif" srcset="/cached/6Mm0Vpe0fg-700.avif 700w, /cached/6Mm0Vpe0fg-900.avif 900w, /cached/6Mm0Vpe0fg-1100.avif 1100w, /cached/6Mm0Vpe0fg-1400.avif 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/webp" srcset="/cached/6Mm0Vpe0fg-700.webp 700w, /cached/6Mm0Vpe0fg-900.webp 900w, /cached/6Mm0Vpe0fg-1100.webp 1100w, /cached/6Mm0Vpe0fg-1400.webp 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><source type="image/jpeg" srcset="/cached/6Mm0Vpe0fg-700.jpeg 700w, /cached/6Mm0Vpe0fg-900.jpeg 900w, /cached/6Mm0Vpe0fg-1100.jpeg 1100w, /cached/6Mm0Vpe0fg-1400.jpeg 1400w" sizes="(max-width: 767px) calc(100vw - 40px), 700px"><img alt="Cow on a field" loading="lazy" decoding="async" style="background-size: cover; background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 9 7'%3E %3Cfilter id='b' color-interpolation-filters='sRGB'%3E %3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E %3CfeComponentTransfer%3E %3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E %3C/feComponentTransfer%3E %3C/filter%3E %3Cimage filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAIAAABV+fA3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQImQHEADv/AFqDu1V9tVJ6sU53r012r0t0r0pzrUlvpkVpnQBpldJmkc1ijMleicZahsRZhcRYhMJZg8JVfrkAeKbidaPgcqDgcJ/hcKDlcKDnb5/nZpTXZI7OAKjL96LE75m644+v1Xycu3iXsHSTrU1eX0VTUwBthH5meWhcbk9RYjpPXzNMWT5KWC9NXi9MXzkASlklSFYjR1clSVooS10tS1wzSlwvTWEzS2A4AEhVKURSKEdXKUBOJz5MJ0NSJ0ZXLUpfNUlbL0eNVO/FVFY9AAAAAElFTkSuQmCC'%3E %3C/image%3E %3C/svg%3E&quot;)" src="/cached/6Mm0Vpe0fg-700.jpeg" width="1400" height="1050"></picture></span></p></div></div></div><ul class="pagination"><li class="pagination__prev-page"></li><li class="pagination__next-page"><a href="/blog/pages/2/">Older posts</a></li></ul><nav class="footer-nav"><a href="/blog/archives/">All posts</a></nav></div><footer class="footer">© Shuhei Kagawa</footer></div></body></html>