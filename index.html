<!doctype html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
			<link rel="preload" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,700|Fira+Mono:400&display=swap" as="style">
<link rel="preload" href="https://fonts.gstatic.com/s/firamono/v8/N0bX2SlFPv1weGeLZDtgJv7Ss9XZYQ.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="https://fonts.gstatic.com/s/ibmplexsans/v7/zYXgKVElMYYaJe8bpLHnCwDKhdHeFaxOedc.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="https://fonts.gstatic.com/s/ibmplexsans/v7/zYX9KVElMYYaJe8bpLHnCwDKjWr7AIFsdP3pBms.woff2" as="font" crossorigin="anonymous">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Shuhei Kagawa</title>
      <link rel="icons" sizes="16x16 32x32 48x48" href="/favicon.ico">
      <link rel="alternate" type="application/rss+xml" title="RSS Feed for shuheikagawa.com" href="/blog/feed/rss.xml">
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-309586-8', 'shuheikagawa.com');
  ga('send', 'pageview');
</script>
      <style>:root{--bg-color:#f7f0e7;--text-color:#2d1e14;--highlight-color:#095ae8;--code-bg-color:hsl(
    var(--syntax-hue),
    var(--syntax-saturation),
    var(--syntax-brightness)
  );--code-text-color:var(--code-mono-1);--syntax-hue:230;--syntax-saturation:1%;--syntax-brightness:100%;--code-mono-1:hsl(var(--syntax-hue), 8%, 24%);--code-mono-2:hsl(var(--syntax-hue), 6%, 44%);--code-mono-3:hsl(var(--syntax-hue), 4%, 64%);--code-hue-1:hsl(198, 99%, 37%);--code-hue-2:hsl(221, 76%, 47%);--code-hue-3:hsl(301, 63%, 40%);--code-hue-4:hsl(119, 72%, 31%);--code-hue-5:hsl(5, 68%, 48%);--code-hue-5-2:hsl(344, 84%, 43%);--code-hue-6:hsl(41, 99%, 30%);--code-hue-6-2:hsl(41, 99%, 30%)}@media (prefers-color-scheme:dark){:root{--bg-color:#312b3a;--text-color:#f7f0e7;--highlight-color:#9dc8fb;--syntax-hue:220;--syntax-saturation:13%;--syntax-brightness:11%;--code-mono-1:hsl(var(--syntax-hue), 14%, 87%);--code-mono-2:hsl(var(--syntax-hue), 9%, 55%);--code-mono-3:hsl(var(--syntax-hue), 10%, 40%);--code-hue-1:hsl(187, 47%, 55%);--code-hue-2:hsl(207, 82%, 66%);--code-hue-3:hsl(286, 60%, 67%);--code-hue-4:hsl(95, 38%, 62%);--code-hue-5:hsl(355, 65%, 65%);--code-hue-5-2:hsl(5, 48%, 51%);--code-hue-6:hsl(29, 54%, 61%);--code-hue-6-2:hsl(39, 67%, 69%)}}body{font-family:"IBM Plex Sans",sans-serif;background:#f7f0e7;background:var(--bg-color);color:#2d1e14;color:var(--text-color);padding:0;margin:0;line-height:1.7}.container{width:700px;padding:0 20px;margin:0 auto}a{color:#095ae8;color:var(--highlight-color);transition:color .5s ease}a:hover{opacity:.7}.header{padding:15px 0 5px;display:flex}.header__title{margin:0 10px 0 0;flex-grow:1}.header__title a{color:#095ae8;color:var(--highlight-color);text-decoration:none}.header__nav{flex-grow:0}.menu{list-style-position:outside;list-style-type:none;padding:15px 0;margin:0}.menu__item{display:inline-block;padding:0 0 0 20px}.menu__item a{color:#2d1e14;color:var(--text-color);text-decoration:none}.footer{padding:50px 0 30px;text-align:center}.title{font-size:42px;margin:0;line-height:1.3}.title a{color:#2d1e14;color:var(--text-color);text-decoration:none}.post,.post-list{padding:30px 0 20px}.post:not(:first-child):before{content:"* * *";font-weight:700;display:block;margin:0 auto 45px;font-size:50px;text-align:center}.post .meta{font-size:small;margin:10px 0 20px}.post-list .title{margin-bottom:10px}.post-list-item{line-height:1.6em;padding:10px 0;display:flex}.post-list-item__date{font-size:small;width:90px;flex-shrink:0}.post-list-item__title{font-size:large;margin:0}.post-list-item__title a{text-decoration:none}.content img{max-width:100%}.responsive-image-wrapper{display:block}.responsive-image-outer{display:block;margin:0 auto}.responsive-image-inner{display:block;position:relative}.responsive-image{position:absolute;top:0;left:0}.social-buttons{margin:2em 0 0}.comments{margin-bottom:3em}ol,ul{list-style-position:outside;padding-left:1.4em}.table-wrapper{overflow-x:auto}table{border-collapse:collapse;margin:2em 0}th{font-weight:400;text-align:left}tbody{border-top:1px solid #333;padding:.5em 0}td,th{padding-right:1em}code{background-color:#fff;background-color:var(--code-bg-color);color:#383942;color:var(--code-text-color);padding:.1em .4em .1em;border-radius:.4em;font-size:.9em;font-family:"Fira Mono",monospace}.code__filename{display:inline-block;margin-bottom:13px;padding:5px 10px;font-size:.85em;background-color:#666}.hljs{display:block;line-height:1.5em;padding:15px 20px;overflow-x:auto;-webkit-overflow-scrolling:touch;background-color:#fff;background-color:var(--code-bg-color);color:#383942;color:var(--code-text-color)}.hljs-comment,.hljs-quote{color:#696b76;color:var(--code-mono-2);font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a625a4;color:var(--code-hue-3)}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#cd3527;color:var(--code-hue-5)}.hljs-literal{color:#0083bb;color:var(--code-hue-1)}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#188716;color:var(--code-hue-4)}.hljs-built_in,.hljs-class .hljs-title{color:#986800;color:var(--code-hue-6-2)}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986800;color:var(--code-hue-6)}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#1c56d2;color:var(--code-hue-2)}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}blockquote{border-left:5px solid #2d1e14;border-left:5px solid var(--text-color);font-style:italic;padding:.1em 1.2em;margin-left:0;quotes:"\201C""\201D""\2018""\2019"}blockquote p:first-child:before{content:open-quote;font-family:serif;font-size:3em;font-weight:700;line-height:.1em;margin-right:.2em;vertical-align:-.4em}blockquote cite{color:#999990}blockquote cite:before{content:"- "}.pagination{list-style-position:outside;list-style-type:none;padding:0;margin-top:20px;display:flex;justify-content:space-between}.pagination li{min-height:1em;width:33%}.pagination a{text-decoration:none}.pagination__prev-page a:before{content:"< "}.pagination__next-page{text-align:right}.pagination__next-page a:after{content:" >"}.pagination__archives{flex-grow:1;text-align:center}@media only screen and (max-width:767px){.container{width:auto}.header{display:block}.post,.post-list{padding-top:10px}.title{font-size:24px}.menu__item{padding:0 20px 0 0}.post-list-item{display:block}.hljs{margin-left:-20px;margin-right:-20px;padding:1.4em 20px;border-radius:0}li .hljs{margin-left:0;border-radius:.4em}.responsive-image-wrapper{margin-left:-20px;margin-right:-20px}}</style>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,700|Fira+Mono:400&display=swap">
      <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@shuheikagawa">
<meta property="og:title" content="Shuhei Kagawa">
<meta property="og:site_name" content="Shuhei Kagawa">
    </head>
    <body>
      <div class="container">
        <header class="header">
          <h1 class="header__title">
            <a href="/">Shuhei Kagawa</a>
          </h1>
          <nav class="header__nav">
            <ul class="menu">
              <li class="menu__item">
                <a href="/about/">About</a>
              </li>
              <li class="menu__item">
                <a href="/blog/archives/">All Posts</a>
              </li>
            </ul>
          </nav>
        </header>
        <div class="main">
          
    
    <div class="post">
      <div class="post-header">
        <h1 class="title">
          <a href=/blog/2021/01/13/2020-in-review/>2020 in Review</a>
        </h1>
        <div class="meta">
          <span class="date">Jan 13, 2021</span>
          - <span class="category">Review</span>
        </div>
      </div>
      <div class="content">
        <div>
          <p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 1886px;"><span class="responsive-image-inner" style="padding-top: 74.97348886532343%;"><img class="responsive-image" src="/images/2020-park-yellow-leaves.jpg" alt="Park with yellow leaves"></span></span></span></p>
<p>It&#39;s already been two weeks in 2021, but I&#39;ll write anyway in the spirit of better late than never.</p>
<p>2020 was finally over. It was a weird year. Time flies, but things that happened feels like a long time ago.</p>
<h2 id="work">Work</h2>
<p>I had been working in the same area as before at Zalando, but there were good changes. My team&#39;s structure changed a bit and welcomed new members. It was refreshing to help a brand new product. I was promoted and exposed to new perspectives even though I left the new role before fully embracing it. More close collaboration with colleagues in Dublin happened thanks to the remote work as the default.</p>
<p>At the end of November, <a href="/blog/2020/11/30/4-years-at-zalando/">I left Zalando</a> where I met wonderful colleagues and friends. The four years there became an important part of my life.</p>
<p>After a week of vacation, I started a new job at Google. I am currently working remotely from Berlin but will eventually relocate to Zurich when the situation improves. My current plan is to move at the end of March, but we never know.</p>
<p>This job change took longer than I thought. I applied in February and got a result in June, but most of the positions were canceled due to COVID-19. It took a few more months to find a team to join. I got an offer at the end of August.</p>
<p>A new job means a lot of learning. Now I&#39;m experiencing how it feels to join a new place. I haven&#39;t had this feeling for a while. I tended to think that software engineers should thrive on depths, but I missed that we needed an overview before pursuing depths.</p>
<p>I just finished an onboarding program. I&#39;m excited to catch up and start contributing to real projects.</p>
<h2 id="wfh">WfH</h2>
<p>I had been working from home 100% since February. I liked to go to the office and talk to colleagues in person, but I also like working from home.</p>
<p>It didn&#39;t take long to adapt to working remotely. We were already working cross-location with Dublin and Helsinki using online collaboration tools like GitHub, Google Meet/Chat/Docs. It became even easier to attend meetings than before. Instead of climbing upstairs to go to a meeting room, meetings are only a few clicks away.</p>
<p>The problem was physical equipment. I didn&#39;t realize that the office equipment was very nice before starting WfH. I bought tons of things to set up a comfortable home office—I may write more about this later.</p>
<p>No commuting meant time-saving. I had been spending at least one and a half hours every day commuting. This was huge. At the same time, I lost a good chance of exercise. I try to walk outside every day, but my physical activities drastically decreased.</p>
<h2 id="computer-science">Computer Science</h2>
<p>It was fun to learn and practice algorithms and data structures for interview preparation. I solved about 300 Medium/Hard LeetCode problems in two months. Before 2020, I had been learning them with books and Coursera courses, but knowing and doing are two different things. Solving problems shed light on what I didn&#39;t fully understand. I studied topics that I was stuck—graphs, dynamic programming, string searching, well, most of them!</p>
<p>After the interviews, I still wanted to learn more. Someone on Twitter tweeted about <a href="https://teachyourselfcs.com/">Teach Yourself Computer Science</a>. I started with <em>Operating Systems: Three Easy Pieces</em> because it looked easy to read—and it was. Then I moved on to <em>Computer Systems: A Programmer&#39;s Perspective</em>. The book is more textbook-ish than OSTEP. But I found it fun to learn things that I hadn&#39;t taken a deeper look at—the binary representation of floating-point numbers, assembly, processors, etc.</p>
<h2 id="travel">Travel</h2>
<p>Before COVID-19 started, I traveled to Granada, Spain in January. It&#39;s a city of Alhambra—and free tapas. The city&#39;s bars give you tapas as long as you order drinks. Seafood and Jamón ibérico were so good.</p>
<p>In September between the two lockdowns of the spring and the winter, I visited Goslar, Quedlinburg, and Düsseldorf in Germany to use too many vacation days left. Goslar and Quedlinburg were beautiful. As a substitute for a trip to Japan, I ate Japanese food extravagantly in Düsseldorf. My favorite restaurant was Hyuga. It felt like being at an <em>izakaya</em> in Tokyo. Shochiku, a Japanese supermarket, had a fish counter where you can ask them to cut sashimi. I took it out and ate in the hotel room. So good.</p>
<h2 id="food--drinks">Food &amp; Drinks</h2>
<p>I had rarely used food deliveries before 2020. But yes, I did it this time. My favorite dishes have been Tacos and Korean fried chicken. Also, many restaurants started take-away. I had never imagined taking out <em>ramen</em> before 2020.</p>
<p>I kept drinking bubble tea. Dosha in Friedrichshain is my favorite in Berlin so far. In addition to authentic Taiwanese tea, they have waffles with Tapioca inside!</p>
<p>Then, winter came. Even though warm bubble tea is nice, it became tedious to go out on the cold street to grab drinks. I finally got an entry-level espresso machine and a hand grinder. My less educated taste is already satisfied with it. Let&#39;s see if I can make some latte art in 2021.</p>
<h2 id="books">Books</h2>
<p>I bought 42 books or so but finished only a few non-tech books. Much less than I thought. One was <em>Into The Wild</em>. The others were two volumes about fermented beans, <em>natto</em> in Japanese, around the world even though I&#39;m scared of its smell and haven&#39;t tried it yet.</p>
<p>I want to read more in 2021. I will cut the time on social media and read books instead. If you want to see the progress and my ever-growing <em>Tsundoku</em> collection, here is <a href="https://www.goodreads.com/user/show/57764964-shuhei-kagawa">my Goodreads account</a>.</p>
<h2 id="2021">2021</h2>
<p>I&#39;ll move to another country this year. We can&#39;t socialize in person under the current circumstances, but you know, remote meetings are a few clicks away ;)</p>
<p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 1886px;"><span class="responsive-image-inner" style="padding-top: 74.97348886532343%;"><img class="responsive-image" src="/images/2020-station.jpg" alt="A station in Berlin"></span></span></span></p>

        </div>
      </div>
    </div>
  

    <div class="post">
      <div class="post-header">
        <h1 class="title">
          <a href=/blog/2020/11/30/4-years-at-zalando/>4 Years at Zalando</a>
        </h1>
        <div class="meta">
          <span class="date">Nov 30, 2020</span>
          
        </div>
      </div>
      <div class="content">
        <div>
          <p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 1024px;"><span class="responsive-image-inner" style="padding-top: 75%;"><img class="responsive-image" src="/images/2020-spree.jpg" alt="Spree in November, 2020"></span></span></span></p>
<p>I&#39;m leaving Zalando with fond memories after 4 years. Here I&#39;m writing down my experience. It&#39;s never comprehensive, but I hope some people find it interesting!</p>
<h2 id="beginning">Beginning</h2>
<p>I had lived mostly in Japan for 34 years until 2016. I wanted to travel more, but I was lazy. I decided to work abroad so that I could travel while earning money.</p>
<p>A job-matching website called <a href="https://www.honeypot.io/">Honeypot</a> introduced me to Zalando. I had 5 interviews and got an offer for Senior Software Engineer (Frontend). I accepted the offer without looking into any other companies because I liked the interviewers and the company&#39;s OSS projects looked interesting. (Honeypot was very happy about it. They put me on their top page and <a href="https://blog.honeypot.io/japanese-developer-in-berlin/">an interview blog post</a>.)</p>
<p>I moved from Tokyo to Berlin and joined Zalando in October 2016. With 200 other newbies in a month! Zalando is a fashion e-commerce company that sells shoes, clothes, etc. on its website. I had no clue why they needed so many people at the beginning. Isn&#39;t it a website in the end? I later learned that the visible part of the website was the tip of the iceberg. There were many more areas like wholesale, brand relationship, pricing, warehouse management, shipping, payment, and so on.</p>
<h2 id="teams">Team(s)</h2>
<p>In 2016, Zalando was hiring software engineers with <em>pool hiring</em>. We were hired without specific teams to join. After a month of onboarding, each newbie was offered two departments to choose from. I chose the Catalog and Navigation team in the Fashion Store, the e-commerce website of Zalando.</p>
<p>For the first few months, I thought that the company was providing free beer to employees because fridges were always full of beer bottles even if we drank them a couple of times a week. I later learned that the beer was provided by the delivery lead and the product owner of the team. I joined the right team.</p>
<p>Aside from the beer, I liked the team. We worked together and played together. It was multi-cultural and magically bonded. It was an old team, but several members including me joined the team in late 2016. We learned the German language and explored the city of Berlin. We had BBQs in a park and drank vodka playing games in the office. It felt like a youth again. Some of the teammates were actually young. After two years or so, we stopped drinking as much as we did. We all became grown-ups...? Maybe.</p>
<p>Through re-organizations, the shape of the team has changed. It was split into multiple teams. Some people left and new people joined. But I stayed in the same area more or less.</p>
<h2 id="frontend-engineer">Frontend Engineer...?</h2>
<p>At Zalando, Frontend Engineers were more like JavaScript Fullstack Engineers.</p>
<p>In 2016, Zalando had a slogan &quot;Radical Agility&quot;. It promoted team autonomy and Microservices to support it. Each engineering team was supposed to operate what they built on top of the <a href="https://stups.io/">STUPS</a> infrastructure. Frontend was not an exception. <a href="https://www.mosaic9.org/">Mosaic</a> (frontend-microservices architecture) allowed each product team to own their Node.js servers for data aggregation and React server-side rendering in addition to frontend components.</p>
<p>The team&#39;s responsibilities were broad. Building new features and UI improvements with A/B testing, contributing to shared UI components, web performance optimization, Node.js server operations, 24x7 on-call, writing post mortems, and so on.</p>
<p>In <a href="https://engineering.zalando.com/posts/2018/12/front-end-micro-services.html">the new architecture that the Fashion Store is moving to</a>, product teams don&#39;t need to maintain Node.js servers. I would miss the burden, but I think it&#39;s a good thing.</p>
<h2 id="operation-and-reliability">Operation and Reliability</h2>
<p>I had a good opportunity to work on Node.js servers with serious traffic and business impact. Before joining Zalando, I had worked only on products that didn&#39;t take off or were just taking off. I didn&#39;t have much experience in scaling, monitoring, etc. But writing post mortems became one of my favorite activities after 4 years.</p>
<p>When my team migrated one of Zalando&#39;s most frequently visited pages to the microservice architecture, our journey in this area started. Even among frontend engineers in the team, some of them were frontendy—good at UI—and some of them were backendy. I was a backendy one and started looking into the topic. I found it interesting. It was a nice way to contribute to the team and the business.</p>
<p>I glimpsed SRE initiatives and Cyber Week preparation being set up and evolving. <a href="https://engineering.zalando.com/posts/2020/10/how-zalando-prepares-for-cyber-week.html">How Zalando prepares for Cyber Week</a> is a great overview of the evolution. I had a good chance to take part in it as a member of a product team. The people who formed the SRE team taught us monitoring, alerting, and reliability patterns (retry, circuit breaker, fallback, etc.). Incident response and post mortems were standardized. Then distributed tracing and <a href="https://www.usenix.org/conference/srecon19emea/presentation/mineiro">adaptive paging</a> were introduced.</p>
<p>Some of my contributions were reliability improvements of Node.js services. I researched <a href="(/blog/2017/05/13/http-request-timeouts-in-javascript/)">timeout mechanisms of Node.js HTTP client</a> and added a timeout feature to <a href="https://github.com/zalando-incubator/perron">an HTTP client library</a>. <a href="/blog/2019/04/30/dns-polling/">Built a mitigation strategy for DNS timeouts</a>, <a href="/blog/2018/12/29/histogram-for-time-series-metrics-on-node-js/">improved histogram metrics aggregation</a>, <a href="/blog/2018/09/16/node-js-under-a-microscope/">performed profiling and found interesting findings</a>—I had a chance to talk about it in front of a big audience including TC39 folks... I was nervous!</p>
<p>I was late to the Kubernetes train. The migration from STUPS to Kubernetes didn&#39;t get enough priority in my team. On the other hand, Zalando was an early adapter of Kubernetes and has been <a href="https://www.cncf.io/announcements/2020/08/20/cloud-native-computing-foundation-grants-zalando-the-top-end-user-award/">a strong contributor to the ecosystem</a>. I missed a good learning opportunity to dive into it and learn from the in-house experts.</p>
<h2 id="web-performance">Web Performance</h2>
<p>Another topic that I enjoyed was web performance optimization. It was especially rewarding because it directly contributes to customer experience and the e-commerce business. After my team worked on it, I had an opportunity to write a part of <a href="https://engineering.zalando.com/posts/2018/06/loading-time-matters.html">a blog post about the improvements</a>.</p>
<p>This topic keeps evolving. New metrics like <a href="https://web.dev/vitals/">Web Vitals</a> and more measurement/optimization techniques came out. It is one of the topics that I would want to pursue if I remained at Zalando.</p>
<h2 id="cross-team-collaboration">Cross-Team Collaboration</h2>
<p>I had a chance to work with many other teams in the Fashion Store and other departments. I met and worked with literally hundreds of colleagues. I had never worked with so many people before joining Zalando.</p>
<p>That meant more meetings and alignments. I learned decision making with writing. I still don&#39;t say that I&#39;m good at it, but Google Docs became my favorite editor next to Vim.</p>
<p>I learned that it can be fun to work with many teams. Sometimes it was frustrating because of the time consumed. But it was rewarding to meet with many colleagues and work together.</p>
<h2 id="career">Career</h2>
<p>I saw good examples of career paths. Before joining Zalando, I imagined only two paths for software engineers. Staying as a senior engineer (or a lead engineer) or becoming a manager. It was great to see another path, being a senior individual contributor who takes technical leadership. At Zalando, it&#39;s called Principal Engineer. In addition to technically lead projects, they shape the tech landscape of the company beyond the scope of a team.</p>
<p>I was fortunate enough to be promoted to Principal Engineer this year. A new role gave me new tasks and a new point of view. It&#39;s one of my regrets to leave this role prematurely.</p>
<h2 id="fun">Fun</h2>
<p>I had a lot of fun.</p>
<p>Lunch tours to Schlesisches Tor. Countless drinks at the office. After-drink burgers at Burgermeister. A team event on canoes. Summer BBQs in a park. Company parties with thousands of people and getting lost. <em>Mett</em> —German traditional breakfast of minced raw pork—with some beer in the office at 11 am. Ordering <em>Maß</em> at lunch and learning what it meant when 1L of beer arrived...</p>
<h2 id="next">Next</h2>
<p>It&#39;s been a fun journey. I&#39;m grateful for all the opportunities and learnings. If I went back to 2016, I would do it again.</p>
<p>I&#39;m going to start a new job tomorrow. I hope it will be fun as well!</p>

        </div>
      </div>
    </div>
  

    <div class="post">
      <div class="post-header">
        <h1 class="title">
          <a href=/blog/2020/02/14/switching-colorschemes-of-vim-and-alacritty/>Switching color schemes of Vim and Alacritty</a>
        </h1>
        <div class="meta">
          <span class="date">Feb 14, 2020</span>
          - <span class="category">Vim</span>
        </div>
      </div>
      <div class="content">
        <div>
          <p>I like fountain pens and good notebooks. They spark joy when I write on paper. Computer terminals are like stationery. A good terminal setup makes it fun to work with computers. Here is how I improved colors on my terminal and made it easy to switch them depending on the time and the mood.</p>
<p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 700px;"><span class="responsive-image-inner" style="padding-top: 63.714285714285715%;"><img class="responsive-image" src="/images/light-terminal.png" alt="Ayu Light for Vim and Alacritty"></span></span></span></p>
<h2 id="using-official-color-schemes">Using official color schemes</h2>
<p>I have been using Dracula color scheme on Vim and Alacritty for a while. I liked the colors, but I had a small problem with it on Vim. The pop-up of <code>coc.nvim</code> had the same color as the background color, and it was hard to distinguish a pop-up and the background.</p>
<p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 700px;"><span class="responsive-image-inner" style="padding-top: 23.857142857142858%;"><img class="responsive-image" src="/images/vim-dracula-old.png" alt="dracula from flazz/vim-colorschemes"></span></span></span></p>
<p>I was using Dracula from <a href="https://github.com/flazz/vim-colorschemes">vim-colorschemes</a>, which hadn&#39;t been updated for three years. I tried <a href="https://github.com/dracula/vim">the official Dracula color scheme for Vim</a>. It had a different background color for pop-ups! Yes, it&#39;s subtle, but now I can distinguish pop-ups from the background.</p>
<p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 700px;"><span class="responsive-image-inner" style="padding-top: 23.857142857142858%;"><img class="responsive-image" src="/images/vim-dracula-official.png" alt="dracula from dracula/vim"></span></span></span></p>
<p><a href="https://github.com/flazz/vim-colorschemes">vim-colorschemes</a> is a great way to try out different color schemes. You can get a random color scheme by <code>:colorscheme random</code>. But once you pick a few favorite ones, it&#39;s worth checking if they have official color schemes that are likely to be more maintained.</p>
<p>The same goes for Alacritty. I was using the Dracula color scheme that I converted with <a href="https://github.com/shuhei/colortty">my tool</a> from <a href="https://github.com/mbadolato/iTerm2-Color-Schemes">iTerm2-Color-Schemes</a> for Alacritty. Dracula has <a href="https://github.com/dracula/alacritty">its official Alacritty theme</a>, and it looks better!</p>
<h2 id="termguicolors">termguicolors</h2>
<p>I started trying other color schemes and found Vim&#39;s <code>termguicolors</code> option in <a href="https://github.com/ayu-theme/ayu-vim">ayu-vim</a>&#39;s README. It enables true colors (24-bit colors) instead of 256 colors (8-bit).</p>
<pre><code class="hljs vim"><span class="hljs-keyword">if</span> <span class="hljs-built_in">has</span>(<span class="hljs-string">'termguicolors'</span>)
  <span class="hljs-keyword">set</span> termguicolors
<span class="hljs-keyword">endif</span></code></pre><p>I turned it on, and the colors looked gorgeous! Before learning about <code>termguicolors</code>, I had tried light color schemes like Ayu Light and given up because of too low contrast (left in the following image). With <code>termguicolors</code>, light color schemes became finally usable!</p>
<p><span class="responsive-image-wrapper"><span class="responsive-image-outer" style="max-width: 700px;"><span class="responsive-image-inner" style="padding-top: 63.714285714285715%;"><img class="responsive-image" src="/images/vim-light-colorscheme.png" alt="ayu light in 256 colors and true colors"></span></span></span></p>
<h2 id="switching-color-schemes">Switching color schemes</h2>
<p>After trying dozens of color schemes, I picked the following:</p>
<ul>
<li><a href="https://github.com/ayu-theme/ayu-vim">Ayu</a> Light: Good in the morning or at a place with natural light.</li>
<li><a href="https://github.com/sts10/vim-pink-moon">Pink Moon</a></li>
<li><a href="https://github.com/arcticicestudio/nord-vim">Nord</a>: Low-contrast theme. Good in the night.</li>
</ul>
<p>I started switching color schemes depending on the time and the mood and bumped into a couple of issues. It was tedious to update the color schemes of Vim and Alacritty together. Also, I manage my <code>.alacritty.yml</code> and <code>.vimrc</code> in a git repository. It was annoying that the repository had unstaged changes every time I switched color schemes.</p>
<h2 id="solution">Solution</h2>
<h3 id="alacritty">Alacritty</h3>
<p>I decided to remove <code>.alacritty.yml</code> from the git repository and generate it out of a base template and color scheme files. Once I prepared a YAML file for each color scheme, it was quite easy with a one-liner.</p>
<pre><code class="hljs sh">cat alacritty/base.yml alacritty/<span class="hljs-variable">${color}</span>.yml &gt; .alacritty.yml</code></pre><h3 id="vim">Vim</h3>
<p>I could have generated <code>.vimrc</code>, but it felt weird because VimScript is a programming language. Instead of generating the whole <code>.vimrc</code>, I decided to generate a color scheme file <code>.vim/color.vim</code>, which is in <code>.gitignore</code></p>
<pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">'let ayucolor="light"\ncolorscheme ayu'</span> &gt; ~/.vim/color.vim</code></pre><p>and load it from <code>.vimrc</code>.</p>
<pre><code class="hljs vim"><span class="hljs-keyword">let</span> color_path = <span class="hljs-built_in">expand</span>(<span class="hljs-string">'~/.vim/color.vim'</span>)
<span class="hljs-keyword">if</span> <span class="hljs-built_in">filereadable</span>(color_path)
  exec <span class="hljs-string">'source'</span> color_path
<span class="hljs-keyword">else</span>
  <span class="hljs-comment">" Default color scheme</span>
  <span class="hljs-keyword">colorscheme</span> pink-moon
<span class="hljs-keyword">endif</span></code></pre><h3 id="putting-them-together">Putting them together</h3>
<p>Then, I created a shell script named <code>colorscheme</code> to switch color schemes of Vim and Alacritty together.</p>
<pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh
</span>
color=<span class="hljs-variable">$1</span>
dotfiles=~/dotfiles
alacritty=<span class="hljs-variable">${dotfiles}</span>/alacritty

<span class="hljs-function"><span class="hljs-title">configure_alacritty</span></span>() {
  cat <span class="hljs-variable">${alacritty}</span>/base.yml <span class="hljs-variable">${alacritty}</span>/<span class="hljs-variable">${color}</span>.yml &gt; <span class="hljs-variable">${dotfiles}</span>/.alacritty.yml
}

<span class="hljs-function"><span class="hljs-title">configure_vim</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$1</span> &gt; <span class="hljs-variable">${dotfiles}</span>/.vim/color.vim
}

<span class="hljs-keyword">case</span> <span class="hljs-variable">$color</span> <span class="hljs-keyword">in</span>
  dracula)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme dracula'</span>
    ;;
  nord)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme nord'</span>
    ;;
  pink-moon)
    configure_alacritty
    configure_vim <span class="hljs-string">'colorscheme pink-moon'</span>
    ;;
  ayu-light)
    configure_alacritty
    configure_vim <span class="hljs-string">'let ayucolor="light"\ncolorscheme ayu'</span>
    ;;
  *)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Supported colorschemes: dracula, nord, pink-moon, ayu-light"</span>
    <span class="hljs-built_in">exit</span> 1
    ;;
<span class="hljs-keyword">esac</span></code></pre><p>Now I can switch color schemes with only one command! (I still need to restart/reload open Vim sessions, but I can live with it.)</p>
<pre><code class="hljs sh">colorscheme ayu-light
colorscheme nord</code></pre><p>If you are curious about the full setup, check out <a href="https://github.com/shuhei/dotfiles">my dotfiles repo</a>.</p>
<h2 id="summary">Summary</h2>
<ul>
<li>Official color schemes may have more features than color scheme bundles</li>
<li>Enable <code>termguicolors</code> on Vim</li>
<li>Switch color schemes with a command!</li>
</ul>

        </div>
      </div>
    </div>
  
    <ul class="pagination">
      <li class="pagination__prev-page">
        
      </li>
      <li class="pagination__archives">
        <a href="/blog/archives/">Archives</a>
      </li>
      <li class="pagination__next-page">
        <a href=/blog/pages/2/>Older Posts</a>
      </li>
    </ul>
  
        </div>
        <footer class="footer">
          © Shuhei Kagawa
        </footer>
      </div>
    </body>
  </html>